<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Instrumenting Java code in AWS Lambda - AWS Lambda</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="java-tracing" /><meta name="default_state" content="java-tracing" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/java-tracing.html" /><meta name="description" content="Learn how to instrument Java Lambda functions using X-Ray tracing." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Lambda" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="" /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/java-tracing.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/java-tracing.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/java-tracing.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/java-tracing.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/java-tracing.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/java-tracing.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/java-tracing.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/java-tracing.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/java-tracing.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/java-tracing.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/java-tracing.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/java-tracing.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/java-tracing.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/java-tracing.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/java-tracing.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/java-tracing.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/java-tracing.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/java-tracing.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/java-tracing.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/java-tracing.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lambda/latest/dg/java-tracing.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/java-tracing.html" hreflang="x-default" /><meta name="feedback-item" content="Lambda" /><meta name="this_doc_product" content="AWS Lambda" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lambda'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Instrumenting Java code in AWS Lambda" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Instrumenting Java code in AWS Lambda - AWS Lambda</title><meta name="pdf" content="/pdfs/lambda/latest/dg/lambda-dg.pdf#java-tracing" /><meta name="rss" content="lambda-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/java-tracing.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/java-tracing.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/java-tracing.html" /><meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing,java runtimes,java lambda,java Lambda function,trace Java Lambda function,instrument Java Lambda function,Lambda Java tracing,ADOT,Lambda ADOT,Lambda telemetry" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Building Lambda functions with Java",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-java.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Instrumenting Java code in AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-java.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lambda/latest/dg/lambda-dg.pdf#java-tracing" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div><div id="page-toc-src"><a href="#java-tracing-sam">Using Powertools for AWS Lambda (Java) and AWS SAM for tracing</a><a href="#java-tracing-cdk">Using Powertools for AWS Lambda (Java) and the AWS CDK for tracing</a><a href="#java-adot">Using ADOT to instrument your Java functions</a><a href="#java-xray-sdk">Using the X-Ray SDK to instrument your Java functions</a><a href="#java-tracing-console">Activating tracing with the Lambda console</a><a href="#java-tracing-api">Activating tracing with the Lambda API</a><a href="#java-tracing-cloudformation">Activating tracing with AWS CloudFormation</a><a href="#java-tracing-interpretation">Interpreting an X-Ray trace</a><a href="#java-tracing-layers">Storing runtime dependencies in a layer (X-Ray SDK)</a><a href="#java-tracing-samples">X-Ray tracing in sample applications (X-Ray SDK)</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="java-tracing">Instrumenting Java code in AWS Lambda</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Lambda integrates with AWS X-Ray to help you trace, debug, and optimize Lambda applications. You can use X-Ray
    to trace a request as it traverses resources in your application, which may include Lambda functions and other AWS
    services.</p><p>To send tracing data to X-Ray, you can use one of two SDK libraries:</p><div class="itemizedlist">
     
     
     
  <ul class="itemizedlist"><li class="listitem">
      <p><a href="http://aws.amazon.com/otel" rel="noopener noreferrer" target="_blank"><span>AWS Distro for OpenTelemetry (ADOT)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A secure, production-ready,
        AWS-supported distribution of the OpenTelemetry (OTel) SDK.</p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-java.html">AWS X-Ray SDK for Java</a> – An SDK
        for generating and sending trace data to X-Ray.</p>
    </li><li class="listitem">
      <p><a href="https://docs.powertools.aws.dev/lambda-java/" rel="noopener noreferrer" target="_blank"><span>Powertools for AWS Lambda (Java)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A developer toolkit to implement Serverless 
      best practices and increase developer velocity.</p>
    </li></ul></div><p>Each of the SDKs offer ways to send your telemetry data to the X-Ray service.
    You can then use X-Ray to view, filter, and gain insights into your application's performance metrics to identify
    issues and opportunities for optimization.</p><div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>The X-Ray and Powertools for AWS Lambda SDKs are part of a tightly integrated instrumentation solution offered by AWS. 
The ADOT Lambda Layers are part of an industry-wide standard for tracing instrumentation that collect more data in general, but may not be 
suited for all use cases. You can implement end-to-end tracing in X-Ray using either solution. To learn more about choosing between them, see 
<a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-instrumenting-your-app.html#xray-instrumenting-choosing">Choosing between the AWS 
Distro for Open Telemetry and X-Ray SDKs</a>.</p></div></div><div class="highlights" id="inline-topiclist"><h6>Sections</h6><ul><li><a href="#java-tracing-sam">Using Powertools for AWS Lambda (Java) and AWS SAM for tracing</a></li><li><a href="#java-tracing-cdk">Using Powertools for AWS Lambda (Java) and the AWS CDK for tracing</a></li><li><a href="#java-adot">Using ADOT to instrument your Java functions</a></li><li><a href="#java-xray-sdk">Using the X-Ray SDK to instrument your Java functions</a></li><li><a href="#java-tracing-console">Activating tracing with the Lambda console</a></li><li><a href="#java-tracing-api">Activating tracing with the Lambda API</a></li><li><a href="#java-tracing-cloudformation">Activating tracing with AWS CloudFormation</a></li><li><a href="#java-tracing-interpretation">Interpreting an X-Ray trace</a></li><li><a href="#java-tracing-layers">Storing runtime dependencies in a layer (X-Ray SDK)</a></li><li><a href="#java-tracing-samples">X-Ray tracing in sample applications (X-Ray SDK)</a></li></ul></div>
    <h2 id="java-tracing-sam">Using Powertools for AWS Lambda (Java) and AWS SAM for tracing</h2>
    <p>Follow the steps below to download, build, and deploy a sample Hello World Java application with integrated <a href="https://docs.powertools.aws.dev/lambda-java" rel="noopener noreferrer" target="_blank"><span>Powertools for AWS Lambda (Java)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> modules using the AWS SAM. This application implements a 
      basic API backend and uses Powertools for emitting logs, metrics, and traces. It consists of an Amazon API Gateway endpoint and a Lambda function. 
      When you send a GET request to the API Gateway endpoint, the Lambda function invokes, sends logs and metrics using Embedded Metric Format to CloudWatch, and 
      sends traces to AWS X-Ray. The function returns a <code class="code">hello world</code> message.</p>
    <div class="itemizedlist">
    <h6>Prerequisites</h6>
    <p>To complete the steps in this section, you must have the following:</p>
     
     
     
<ul class="itemizedlist"><li class="listitem">
      <p>Java 11</p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI version 2</a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI version 1.75 or later</a>. If you have an older version of the AWS SAM CLI, see <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/manage-sam-cli-versions.html#manage-sam-cli-versions-upgrade">Upgrading the AWS SAM CLI</a>.</p>
    </li></ul></div>
    <div class="procedure"><h6>Deploy a sample AWS SAM application</h6><ol><li>
        <p>Initialize the application using the Hello World Java template.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">sam init --app-template hello-world-powertools-java --name sam-app --package-type Zip --runtime java11 --no-tracing</code></pre>
      </li><li>
        <p>Build the app.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cd sam-app &amp;&amp; sam build</code></pre>
      </li><li>
        <p>Deploy the app.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">sam deploy --guided</code></pre>
      </li><li>
        <p>Follow the on-screen prompts. To accept the default options provided in the interactive experience, press <code class="code">Enter</code>.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>For <b>HelloWorldFunction may not have authorization defined, Is this okay?</b>, make sure to enter <code class="code">y</code>.</p></div></div>
      </li><li>
        <p>Get the URL of the deployed application:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">aws cloudformation describe-stacks --stack-name sam-app --query 'Stacks[0].Outputs[?OutputKey==`HelloWorldApi`].OutputValue' --output text</code></pre>
      </li><li>
        <p>Invoke the API endpoint:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">curl -X GET <code class="replaceable">&lt;URL_FROM_PREVIOUS_STEP&gt;</code></code></pre>
        <p>If successful, you'll see this response:</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class=""><span>{</span>"message":"hello world"}</code></pre>
      </li><li>
        <p>To get the traces for the function, run <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-traces.html">sam traces</a>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">sam traces</code></pre> 
        <p>The trace output looks like this:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">New XRay Service Graph
  Start time: 2023-02-03 14:31:48+01:00
  End time: 2023-02-03 14:31:48+01:00
  Reference Id: 0 - (Root) AWS::Lambda - sam-app-HelloWorldFunction-y9Iu1FLJJBGD - Edges: []
   Summary_statistics:
     - total requests: 1
     - ok count(2XX): 1
     - error count(4XX): 0
     - fault count(5XX): 0
     - total response time: 5.587
  Reference Id: 1 - client - sam-app-HelloWorldFunction-y9Iu1FLJJBGD - Edges: [0]
   Summary_statistics:
     - total requests: 0
     - ok count(2XX): 0
     - error count(4XX): 0
     - fault count(5XX): 0
     - total response time: 0

XRay Event [revision 3] at (2023-02-03T14:31:48.500000) with id (1-63dd0cc4-3c869dec72a586875da39777) and duration (5.603s)
 - 5.587s - sam-app-HelloWorldFunction-y9Iu1FLJJBGD [HTTP: 200]
 - 4.053s - sam-app-HelloWorldFunction-y9Iu1FLJJBGD
   - 1.181s - Initialization
   - 4.037s - Invocation
     - 1.981s - ## handleRequest
       - 1.840s - ## getPageContents
   - 0.000s - Overhead</code></pre>
      </li><li>
        <p>This is a public API endpoint that is accessible over the internet. We recommend that you delete the endpoint after testing.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">sam delete</code></pre> 
      </li></ol></div>
   
    <h2 id="java-tracing-cdk">Using Powertools for AWS Lambda (Java) and the AWS CDK for tracing</h2>
    <p>Follow the steps below to download, build, and deploy a sample Hello World Java application with integrated <a href="https://docs.powertools.aws.dev/lambda-java" rel="noopener noreferrer" target="_blank"><span>Powertools for AWS Lambda (Java)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> modules using the AWS CDK. This application implements a 
      basic API backend and uses Powertools for emitting logs, metrics, and traces. It consists of an Amazon API Gateway endpoint and a Lambda function. 
      When you send a GET request to the API Gateway endpoint, the Lambda function invokes, sends logs and metrics using Embedded Metric Format to CloudWatch, and 
      sends traces to AWS X-Ray. The function returns a hello world message.</p>
    <div class="itemizedlist">
      <h6>Prerequisites</h6>
      <p>To complete the steps in this section, you must have the following:</p>
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
          <p>Java 11</p>
      </li><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI version 2</a></p>
      </li><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/cdk/v2/guide/getting_started.html#getting_started_prerequisites">AWS CDK version 2</a></p>
      </li><li class="listitem">
        <p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI version 1.75 or later</a>. If you have an older version of the AWS SAM CLI, see <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/manage-sam-cli-versions.html#manage-sam-cli-versions-upgrade">Upgrading the AWS SAM CLI</a>.</p>
      </li></ul></div>
    <div class="procedure"><h6>Deploy a sample AWS CDK application</h6><ol><li>
        <p>Create a project directory for your new application.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">mkdir hello-world
cd hello-world</code></pre>
      </li><li>
        <p>Initialize the app.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">cdk init app --language java</code></pre>
      </li><li>
        <p>Create a maven project with the following command:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">mkdir app
cd app
mvn archetype:generate -DgroupId=helloworld -DartifactId=Function -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</code></pre>
      </li><li><p>Open <code class="code">pom.xml</code> in the <code class="code">hello-world\app\Function</code> directory and replace the existing code with the following code that includes dependencies and maven plugins for Powertools.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;helloworld&lt;/groupId&gt;
  &lt;artifactId&gt;Function&lt;/artifactId&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;Function&lt;/name&gt;
  &lt;url&gt;http://maven.apache.org&lt;/url&gt;
&lt;properties&gt;
    &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
    &lt;log4j.version&gt;2.17.2&lt;/log4j.version&gt;
&lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.lambda&lt;/groupId&gt;
            &lt;artifactId&gt;powertools-tracing&lt;/artifactId&gt;
            &lt;version&gt;1.3.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.lambda&lt;/groupId&gt;
            &lt;artifactId&gt;powertools-metrics&lt;/artifactId&gt;
            &lt;version&gt;1.3.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.lambda&lt;/groupId&gt;
            &lt;artifactId&gt;powertools-logging&lt;/artifactId&gt;
            &lt;version&gt;1.3.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-lambda-java-core&lt;/artifactId&gt;
            &lt;version&gt;1.2.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-lambda-java-events&lt;/artifactId&gt;
            &lt;version&gt;3.11.1&lt;/version&gt;
        &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
            &lt;artifactId&gt;aspectj-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.14.0&lt;/version&gt;
            &lt;configuration&gt;
                &lt;source&gt;$<span>{</span>maven.compiler.source}&lt;/source&gt;
                &lt;target&gt;$<span>{</span>maven.compiler.target}&lt;/target&gt;
                &lt;complianceLevel&gt;$<span>{</span>maven.compiler.target}&lt;/complianceLevel&gt;
                &lt;aspectLibraries&gt;
                    &lt;aspectLibrary&gt;
                        &lt;groupId&gt;software.amazon.lambda&lt;/groupId&gt;
                        &lt;artifactId&gt;powertools-tracing&lt;/artifactId&gt;
                    &lt;/aspectLibrary&gt;
                    &lt;aspectLibrary&gt;
                        &lt;groupId&gt;software.amazon.lambda&lt;/groupId&gt;
                        &lt;artifactId&gt;powertools-metrics&lt;/artifactId&gt;
                    &lt;/aspectLibrary&gt;
                    &lt;aspectLibrary&gt;
                        &lt;groupId&gt;software.amazon.lambda&lt;/groupId&gt;
                        &lt;artifactId&gt;powertools-logging&lt;/artifactId&gt;
                    &lt;/aspectLibrary&gt;
                &lt;/aspectLibraries&gt;
            &lt;/configuration&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;compile&lt;/goal&gt;
                    &lt;/goals&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.4.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;shade&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;transformers&gt;
                                &lt;transformer
                                        implementation="com.github.edwgiz.maven_shade_plugin.log4j2_cache_transformer.PluginsCacheFileTransformer"&gt;
                                &lt;/transformer&gt;
                            &lt;/transformers&gt;
                            &lt;createDependencyReducedPom&gt;false&lt;/createDependencyReducedPom&gt;
                            &lt;finalName&gt;function&lt;/finalName&gt;

                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;com.github.edwgiz&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-shade-plugin.log4j2-cachefile-transformer&lt;/artifactId&gt;
                        &lt;version&gt;2.15&lt;/version&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
&lt;/project&gt;
</code></pre></li><li><p>Create  the <code class="code">hello-world\app\src\main\resource</code> directory and create <code class="code">log4j.xml</code> for the log configuration.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">mkdir -p src/main/resource
cd src/main/resource
touch log4j.xml</code></pre></li><li>
        <p>Open <code class="code">log4j.xml</code> and add the following code.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration&gt;
    &lt;Appenders&gt;
        &lt;Console name="JsonAppender" target="SYSTEM_OUT"&gt;
            &lt;JsonTemplateLayout eventTemplateUri="classpath:LambdaJsonLayout.json" /&gt;
        &lt;/Console&gt;
    &lt;/Appenders&gt;
    &lt;Loggers&gt;
        &lt;Logger name="JsonLogger" level="INFO" additivity="false"&gt;
            &lt;AppenderRef ref="JsonAppender"/&gt;
        &lt;/Logger&gt;
        &lt;Root level="info"&gt;
            &lt;AppenderRef ref="JsonAppender"/&gt;
        &lt;/Root&gt;
    &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
      </li><li><p>Open <code class="code">App.java</code> from the <code class="code">hello-world\app\Function\src\main\java\helloworld</code> directory and replace the existing code with the following code. 
        This is the code for the Lambda function.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">package helloworld;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URL;
import java.util.HashMap;
import java.util.Map;
import java.util.stream.Collectors;

import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;
import com.amazonaws.services.lambda.runtime.events.APIGatewayProxyRequestEvent;
import com.amazonaws.services.lambda.runtime.events.APIGatewayProxyResponseEvent;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import software.amazon.lambda.powertools.logging.Logging;
import software.amazon.lambda.powertools.metrics.Metrics;
import software.amazon.lambda.powertools.tracing.CaptureMode;
import software.amazon.lambda.powertools.tracing.Tracing;

import static software.amazon.lambda.powertools.tracing.CaptureMode.*;

/**
 * Handler for requests to Lambda function.
 */
public class App implements RequestHandler&lt;APIGatewayProxyRequestEvent, APIGatewayProxyResponseEvent&gt; <span>{</span>
    Logger log = LogManager.getLogger(App.class);


    @Logging(logEvent = true)
    @Tracing(captureMode = DISABLED)
    @Metrics(captureColdStart = true)
    public APIGatewayProxyResponseEvent handleRequest(final APIGatewayProxyRequestEvent input, final Context context) <span>{</span>
        Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();
        headers.put("Content-Type", "application/json");
        headers.put("X-Custom-Header", "application/json");

        APIGatewayProxyResponseEvent response = new APIGatewayProxyResponseEvent()
                .withHeaders(headers);
        try <span>{</span>
            final String pageContents = this.getPageContents("https://checkip.amazonaws.com");
            String output = String.format("<span>{</span> \"message\": \"hello world\", \"location\": \"%s\" }", pageContents);

            return response
                    .withStatusCode(200)
                    .withBody(output);
        } catch (IOException e) <span>{</span>
            return response
                    .withBody("<span>{</span>}")
                    .withStatusCode(500);
        }
    }
    @Tracing(namespace = "getPageContents")
    private String getPageContents(String address) throws IOException <span>{</span>
        log.info("Retrieving <span>{</span>}", address);
        URL url = new URL(address);
        try (BufferedReader br = new BufferedReader(new InputStreamReader(url.openStream()))) <span>{</span>
            return br.lines().collect(Collectors.joining(System.lineSeparator()));
        }
    }
}</code></pre></li><li>
        <p>Open <code class="code">HelloWorldStack.java</code> from the <code class="code">hello-world\src\main\java\com\myorg</code> directory and replace the existing code with the following code. This code uses 
          <a href="https://docs.aws.amazon.com/cdk/api/v1/java/aws_cdk.aws_lambda.html">Lambda Constructor</a>and the 
          <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2-readme.html">ApiGatewayv2 Constructor</a> 
          to create a REST API and a Lambda function.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">package com.myorg;

import software.amazon.awscdk.*;
import software.amazon.awscdk.services.apigatewayv2.alpha.*;
import software.amazon.awscdk.services.apigatewayv2.integrations.alpha.HttpLambdaIntegration;
import software.amazon.awscdk.services.apigatewayv2.integrations.alpha.HttpLambdaIntegrationProps;
import software.amazon.awscdk.services.lambda.Code;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.FunctionProps;
import software.amazon.awscdk.services.lambda.Runtime;
import software.amazon.awscdk.services.lambda.Tracing;
import software.amazon.awscdk.services.logs.RetentionDays;
import software.amazon.awscdk.services.s3.assets.AssetOptions;
import software.constructs.Construct;

import java.util.Arrays;
import java.util.List;

import static java.util.Collections.singletonList;
import static software.amazon.awscdk.BundlingOutput.ARCHIVED;

public class HelloWorldStack extends Stack <span>{</span>
    public HelloWorldStack(final Construct scope, final String id) <span>{</span>
        this(scope, id, null);
    }

    public HelloWorldStack(final Construct scope, final String id, final StackProps props) <span>{</span>
        super(scope, id, props);

        List&lt;String&gt; functionPackagingInstructions = Arrays.asList(
                "/bin/sh",
                "-c",
                "cd Function " +
                        "&amp;&amp; mvn clean install " +
                        "&amp;&amp; cp /asset-input/Function/target/function.jar /asset-output/"
        );
        BundlingOptions.Builder builderOptions = BundlingOptions.builder()
                .command(functionPackagingInstructions)
                .image(Runtime.JAVA_11.getBundlingImage())
                .volumes(singletonList(
                        // Mount local .m2 repo to avoid download all the dependencies again inside the container
                        DockerVolume.builder()
                                .hostPath(System.getProperty("user.home") + "/.m2/")
                                .containerPath("/root/.m2/")
                                .build()
                ))
                .user("root")
                .outputType(ARCHIVED);

        Function function = new Function(this, "Function", FunctionProps.builder()
                .runtime(Runtime.JAVA_11)
                .code(Code.fromAsset("app", AssetOptions.builder()
                        .bundling(builderOptions
                                .command(functionPackagingInstructions)
                                .build())
                        .build()))
                .handler("helloworld.App::handleRequest")
                .memorySize(1024)
                .tracing(Tracing.ACTIVE)
                .timeout(Duration.seconds(10))
                .logRetention(RetentionDays.ONE_WEEK)
                .build());

        HttpApi httpApi = new HttpApi(this, "sample-api", HttpApiProps.builder()
                .apiName("sample-api")
                .build());

        httpApi.addRoutes(AddRoutesOptions.builder()
                .path("/")
                .methods(singletonList(HttpMethod.GET))
                .integration(new HttpLambdaIntegration("function", function, HttpLambdaIntegrationProps.builder()
                        .payloadFormatVersion(PayloadFormatVersion.VERSION_2_0)
                        .build()))
                .build());

        new CfnOutput(this, "HttpApi", CfnOutputProps.builder()
                .description("Url for Http Api")
                .value(httpApi.getApiEndpoint())
                .build());
    }
}</code></pre>
      </li><li><p>Open <code class="code">pom.xml</code> from the <code class="code">hello-world</code> directory and replace the existing code with the following code.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
         xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.myorg&lt;/groupId&gt;
    &lt;artifactId&gt;hello-world&lt;/artifactId&gt;
    &lt;version&gt;0.1&lt;/version&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;cdk.version&gt;2.70.0&lt;/cdk.version&gt;
        &lt;constructs.version&gt;[10.0.0,11.0.0)&lt;/constructs.version&gt;
        &lt;junit.version&gt;5.7.1&lt;/junit.version&gt;
    &lt;/properties&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.8.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;

            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.0.0&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.myorg.HelloWorldApp&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

    &lt;dependencies&gt;
        &lt;!-- AWS Cloud Development Kit --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
            &lt;artifactId&gt;aws-cdk-lib&lt;/artifactId&gt;
            &lt;version&gt;$<span>{</span>cdk.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;software.constructs&lt;/groupId&gt;
            &lt;artifactId&gt;constructs&lt;/artifactId&gt;
            &lt;version&gt;$<span>{</span>constructs.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
          &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;
          &lt;version&gt;$<span>{</span>junit.version}&lt;/version&gt;
          &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
            &lt;artifactId&gt;apigatewayv2-alpha&lt;/artifactId&gt;
            &lt;version&gt;$<span>{</span>cdk.version}-alpha.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
            &lt;artifactId&gt;apigatewayv2-integrations-alpha&lt;/artifactId&gt;
            &lt;version&gt;$<span>{</span>cdk.version}-alpha.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</code></pre></li><li>
        <p>Make sure you’re in the <code class="code">hello-world</code> directory and deploy your application.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cdk deploy</code></pre>
      </li><li>
        <p>Get the URL of the deployed application:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">aws cloudformation describe-stacks --stack-name HelloWorldStack --query 'Stacks[0].Outputs[?OutputKey==`HttpApi`].OutputValue' --output text</code></pre>
      </li><li>
        <p>Invoke the API endpoint:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">curl -X GET <code class="replaceable">&lt;URL_FROM_PREVIOUS_STEP&gt;</code></code></pre>
        <p>If successful, you'll see this response:</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class=""><span>{</span>"message":"hello world"}</code></pre>
      </li><li>
        <p>To get the traces for the function, run <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-traces.html">sam traces</a>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">sam traces</code></pre> 
        <p>The trace output looks like this:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">New XRay Service Graph
  Start time: 2023-02-03 14:59:50+00:00
  End time: 2023-02-03 14:59:50+00:00
  Reference Id: 0 - (Root) AWS::Lambda - sam-app-HelloWorldFunction-YBg8yfYtOc9j - Edges: [1]
   Summary_statistics:
     - total requests: 1
     - ok count(2XX): 1
     - error count(4XX): 0
     - fault count(5XX): 0
     - total response time: 0.924
  Reference Id: 1 - AWS::Lambda::Function - sam-app-HelloWorldFunction-YBg8yfYtOc9j - Edges: []
   Summary_statistics:
     - total requests: 1
     - ok count(2XX): 1
     - error count(4XX): 0
     - fault count(5XX): 0
     - total response time: 0.016
  Reference Id: 2 - client - sam-app-HelloWorldFunction-YBg8yfYtOc9j - Edges: [0]
   Summary_statistics:
     - total requests: 0
     - ok count(2XX): 0
     - error count(4XX): 0
     - fault count(5XX): 0
     - total response time: 0

XRay Event [revision 1] at (2023-02-03T14:59:50.204000) with id (1-63dd2166-434a12c22e1307ff2114f299) and duration (0.924s)
 - 0.924s - sam-app-HelloWorldFunction-YBg8yfYtOc9j [HTTP: 200]
 - 0.016s - sam-app-HelloWorldFunction-YBg8yfYtOc9j
   - 0.739s - Initialization
   - 0.016s - Invocation
     - 0.013s - ## lambda_handler
       - 0.000s - ## app.hello
   - 0.000s - Overhead</code></pre> 
      </li><li>
        <p>This is a public API endpoint that is accessible over the internet. We recommend that you delete the endpoint after testing.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cdk destroy</code></pre> 
      </li></ol></div>
   
    <h2 id="java-adot">Using ADOT to instrument your Java functions</h2>
    <p>ADOT provides fully managed Lambda <a href="./gettingstarted-concepts.html#gettingstarted-concepts-layer">layers</a> that package
      everything you need to collect telemetry data using the OTel SDK. By consuming this layer, you can instrument your
      Lambda functions without having to modify any function code. You can also configure your layer to do custom
      initialization of OTel. For more information, see <a href="https://aws-otel.github.io/docs/getting-started/lambda#custom-configuration-for-the-adot-collector-on-lambda" rel="noopener noreferrer" target="_blank"><span>Custom configuration for the ADOT Collector on Lambda</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the ADOT documentation.</p>
    <p>For Java runtimes, you can choose between two layers to consume:</p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>AWS managed Lambda layer for ADOT Java (Auto-instrumentation Agent)</b>
          – This layer automatically transforms your function code at startup to collect tracing data. For
          detailed instructions on how to consume this layer together with the ADOT Java agent, see <a href="https://aws-otel.github.io/docs/getting-started/lambda/lambda-java-auto-instr" rel="noopener noreferrer" target="_blank"><span>AWS Distro for
            OpenTelemetry Lambda Support for Java (Auto-instrumentation Agent)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the ADOT
          documentation.</p>
      </li><li class="listitem">
        <p><b>AWS managed Lambda layer for ADOT Java</b> – This layer also
          provides built-in instrumentation for Lambda functions, but it requires a few manual code changes to initialize
          the OTel SDK. For detailed instructions on how to consume this layer, see <a href="https://aws-otel.github.io/docs/getting-started/lambda/lambda-java" rel="noopener noreferrer" target="_blank"><span>AWS Distro for OpenTelemetry
            Lambda Support for Java</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the ADOT documentation.</p>
      </li></ul></div>
   
    <h2 id="java-xray-sdk">Using the X-Ray SDK to instrument your Java functions</h2>
    <p>To record data about calls that your function makes to other resources and services in your application, you
      can add the X-Ray SDK for Java to your build configuration. The following example shows a Gradle build
      configuration that includes the libraries that activate automatic instrumentation of AWS SDK for Java 2.x clients.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/s3-java/build.gradle" rel="noopener noreferrer" target="_blank"><span>build.gradle</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Tracing
        dependencies</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">dependencies <span>{</span>
    implementation platform('software.amazon.awssdk:bom:2.15.0')
    <code class="userinput">implementation platform('com.amazonaws:aws-xray-recorder-sdk-bom:2.11.0')</code>
    ...
    <code class="userinput">implementation 'com.amazonaws:aws-xray-recorder-sdk-core'
    implementation 'com.amazonaws:aws-xray-recorder-sdk-aws-sdk'
    implementation 'com.amazonaws:aws-xray-recorder-sdk-aws-sdk-instrumentor'</code>
    ...
}</code></pre></div></div>
    <p>After you add the correct dependencies and make the necessary code changes, activate tracing in your
      function's configuration via the Lambda console or the API.</p>
   
    <h2 id="java-tracing-console">Activating tracing with the Lambda console</h2>
    <p>To toggle active tracing on your Lambda function with the console, follow these steps:</p>
    <div class="procedure"><h6>To turn on active tracing</h6><ol><li><p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> of the Lambda console.</p></li><li>
      <p>Choose a function.</p>
    </li><li><p>Choose <b>Configuration</b> and then choose <b>Monitoring and operations tools</b>.</p></li><li><p>Choose <b>Edit</b>.</p></li><li>
      <p>Under <b>X-Ray</b>, toggle on <b>Active tracing</b>.</p>
    </li><li>
      <p>Choose <b>Save</b>.</p>
    </li></ol></div>
   
    <h2 id="java-tracing-api">Activating tracing with the Lambda API</h2>
    <p>Configure tracing on your Lambda function with the AWS CLI or AWS SDK, use the following API operations:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem"><p><a href="./API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a></p></li><li class="listitem"><p><a href="./API_GetFunctionConfiguration.html">GetFunctionConfiguration</a></p></li><li class="listitem"><p><a href="./API_CreateFunction.html">CreateFunction</a></p></li></ul></div>
    <p>The following example AWS CLI command enables active tracing on a function named
    <b>my-function</b>.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-configuration --function-name my-function \
--tracing-config Mode=Active</code></code></pre>
    <p>Tracing mode is part of the version-specific configuration when you publish a version of your function.
    You can't change the tracing mode on a published version.</p>
   
    <h2 id="java-tracing-cloudformation">Activating tracing with AWS CloudFormation</h2>
    <p>To activate tracing on an <code class="code">AWS::Lambda::Function</code> resource in an AWS CloudFormation template, use the
        <code class="code">TracingConfig</code> property.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/templates/function-inline.yml" rel="noopener noreferrer" target="_blank"><span>function-inline.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> –
        Tracing configuration</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html">AWS::Lambda::Function</a>
    Properties:
      <code class="userinput">TracingConfig:
        Mode: Active</code>
      ...</code></pre></div></div>
    <p>For an AWS Serverless Application Model (AWS SAM) <code class="code">AWS::Serverless::Function</code> resource, use the <code class="code">Tracing</code>
      property.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/blank-nodejs/template.yml" rel="noopener noreferrer" target="_blank"><span>template.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Tracing
        configuration</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html">AWS::Serverless::Function</a>
    Properties:
      <code class="userinput">Tracing: Active</code>
      ...</code></pre></div></div>
   
    <h2 id="java-tracing-interpretation">Interpreting an X-Ray trace</h2>
    <p>Your function needs permission to upload trace data to X-Ray. When you activate tracing in the Lambda
    console, Lambda adds the required permissions to your function's <a href="./lambda-intro-execution-role.html">execution role</a>. Otherwise, add the <a href="https://console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess" rel="noopener noreferrer" target="_blank"><span>AWSXRayDaemonWriteAccess</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> policy to the execution role.</p>
    <p>After you've configured active tracing, you can observe specific requests
    through your application. The <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-servicegraph">
    X-Ray service graph</a> shows information about your application and all its components. The following example from
    the <a href="./samples-errorprocessor.html">error processor</a> sample application shows an application with two functions.
    The primary function processes events and sometimes returns errors. The second function at the top processes errors that appear
    in the first's log group and uses the AWS SDK to call X-Ray, Amazon Simple Storage Service (Amazon S3), and Amazon CloudWatch Logs.</p>
    <div class="mediaobject">
       
        <img src="/images/lambda/latest/dg/images/sample-errorprocessor-servicemap.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        A diagram that shows two separate applications and their respective service maps in X-Ray&#xA;      " />
       
       
    </div>
    <p>X-Ray doesn't trace all requests to your application. X-Ray applies a sampling algorithm
    to ensure that tracing is efficient, while still providing a representative sample of all requests. The sampling rate is
    1 request per second and 5 percent of additional requests.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>You cannot configure the X-Ray sampling rate for your functions.</p></div></div>
    <p>When using active tracing, Lambda records 2 segments per trace, which creates
  two nodes on the service graph. The following image highlights these two nodes for the primary function from the
  <a href="./samples-errorprocessor.html">error processor sample application</a>.</p>
  <div class="mediaobject">
     
      <img src="/images/lambda/latest/dg/images/xray-servicemap-function.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      An X-Ray service map with a single function.&#xA;    " />
     
     
  </div>
  <p>The first node on the left represents the Lambda service, which receives the invocation request. The second
    node represents your specific Lambda function. The following example shows a trace with these two segments. Both
    are named <b>my-function</b>, but one has an origin of <code class="code">AWS::Lambda</code> and the other has
    origin <code class="code">AWS::Lambda::Function</code>.</p>
  <div class="mediaobject">
     
      <img src="/images/lambda/latest/dg/images/nodejs-xray-timeline.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        An X-Ray trace that shows latency across each subsegment of a specific Lambda invocation.&#xA;      " />
     
       
  </div>
  <p>This example expands the function segment to show its three subsegments:</p>
  <div class="itemizedlist">
     
     
     
  <ul class="itemizedlist"><li class="listitem">
      <p><b>Initialization</b> – Represents time spent loading your function and
        running <a href="./foundation-progmodel.html">initialization code</a>. This subsegment
        only appears for the first event that each instance of your function processes.</p>
    </li><li class="listitem">
      <p><b>Invocation</b> – Represents the time spent running your handler code.</p>
    </li><li class="listitem">
      <p><b>Overhead</b> – Represents the time the Lambda runtime spends preparing
        to handle the next event.</p>
    </li></ul></div>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p><a href="./snapstart.html">Lambda SnapStart</a> functions also include a <code class="code">Restore</code> subsegment. The <code class="code">Restore</code> subsegment shows the time it takes for Lambda to restore a snapshot, load the runtime (JVM), and run any <code class="code">afterRestore</code> <a href="./snapstart-runtime-hooks.html">runtime hooks</a>. The process of restoring snapshots can include time spent on activities outside the MicroVM. This time is reported in the <code class="code">Restore</code> subsegment. You aren't charged for the time spent outside the microVM to restore a snapshot.</p></div></div>
    <p>You can also instrument HTTP clients, record SQL queries, and create custom subsegments with annotations and
      metadata. For more information, see <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-java.html">AWS X-Ray SDK for Java</a> in the <em>AWS X-Ray Developer Guide</em>.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Pricing</h6></div><div class="awsdocs-note-text"><p>You can use X-Ray tracing for free each month up to a certain limit as part of the AWS Free Tier. Beyond that threshold, X-Ray charges for trace storage and
      retrieval. For more information, see <a href="http://aws.amazon.com/xray/pricing/" rel="noopener noreferrer" target="_blank"><span>AWS X-Ray pricing</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></div></div>
   
    <h2 id="java-tracing-layers">Storing runtime dependencies in a layer (X-Ray SDK)</h2>
    <p>If you use the X-Ray SDK to instrument AWS SDK clients your function code, your deployment package can become
      quite large. To avoid uploading runtime dependencies every time you update your function code, package the X-Ray SDK in a
        <a href="./chapter-layers.html">Lambda layer</a>.</p>
    <p>The following example shows an <code class="code">AWS::Serverless::LayerVersion</code> resource that stores the AWS SDK for Java
      and X-Ray SDK for Java.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/blank-java/template.yml" rel="noopener noreferrer" target="_blank"><span>template.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Dependencies
        layer</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html">AWS::Serverless::Function</a>
    Properties:
      CodeUri: build/distributions/blank-java.zip
      Tracing: Active
      <code class="userinput">Layers:
        - !Ref libs</code>
      ...
  <code class="userinput">libs:
    Type: <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-layerversion.html">AWS::Serverless::LayerVersion</a>
    Properties:
      LayerName: blank-java-lib
      Description: Dependencies for the blank-java sample app.
      ContentUri: build/blank-java-lib.zip
      CompatibleRuntimes:
        - java8</code></code></pre></div></div>
    <p>With this configuration, you update the library layer only if you change your runtime dependencies.
    Since the function deployment package contains only your code, this can help reduce upload times.</p>
    <p>Creating a layer for dependencies requires build configuration changes to generate the layer archive prior to
      deployment. For a working example, see the <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/java-basic" rel="noopener noreferrer" target="_blank"><span>java-basic</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> sample
      application on GitHub.</p>
   
    <h2 id="java-tracing-samples">X-Ray tracing in sample applications (X-Ray SDK)</h2>
    
    <p>The GitHub repository for this guide includes sample applications that demonstrate the use of X-Ray tracing.
      Each sample application includes scripts for easy deployment and cleanup, an AWS SAM template, and supporting
      resources.</p>
    <div class="itemizedlist">
  <h6>Sample Lambda applications in Java</h6>
   
   
   
   
   
<ul class="itemizedlist"><li class="listitem">
    <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/java17-examples" rel="noopener noreferrer" target="_blank"><span>java17-examples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A Java function that
      demonstrates how to use a Java record to represent an input event data object.</p>
  </li><li class="listitem">
    <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/java-basic" rel="noopener noreferrer" target="_blank"><span>java-basic</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A collection of minimal Java functions
      with unit tests and variable logging configuration.</p>
  </li><li class="listitem">
    <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/java-events" rel="noopener noreferrer" target="_blank"><span>java-events</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A collection of Java functions that
      contain skeleton code for how to handle events from various services such as Amazon API Gateway, Amazon SQS, and Amazon Kinesis.
      These functions use the latest version of the <a href="./java-package.html">aws-lambda-java-events</a>
      library (3.0.0 and newer). These examples do not require the AWS SDK as a dependency.</p>
  </li><li class="listitem">
    <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/s3-java" rel="noopener noreferrer" target="_blank"><span>s3-java</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A Java function that processes
      notification events from Amazon S3 and uses the Java Class Library (JCL) to create thumbnails from uploaded image
      files.</p>
  </li><li class="listitem">
    <p><a href="https://docs.aws.amazon.com/lambda/latest/dg/example_cross_LambdaAPIGateway_section.html">Use
      API Gateway to invoke a Lambda function</a> – A Java function that scans a Amazon DynamoDB table that
      contains employee information. It then uses Amazon Simple Notification Service to send a text message to employees celebrating
      their work anniversaries. This example uses API Gateway to invoke the function.</p>
  </li></ul></div>
    
    <p>All of the sample applications have active tracing enabled for Lambda functions. For example, the
      <code class="code">s3-java</code> application shows automatic instrumentation of AWS SDK for Java 2.x clients, segment
      management for tests, custom subsegments, and the use of Lambda layers to store runtime dependencies.</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./java-exceptions.html">Errors</div><div id="next" class="next-link" accesskey="n" href="./java-package-eclipse.html">Tutorial - Eclipse IDE</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/java-tracing.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/java-tracing.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>