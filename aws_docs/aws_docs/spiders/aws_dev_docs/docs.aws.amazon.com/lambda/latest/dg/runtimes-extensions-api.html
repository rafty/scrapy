<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Lambda Extensions API - AWS Lambda</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="runtimes-extensions-api" /><meta name="default_state" content="runtimes-extensions-api" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html" /><meta name="description" content="Use the extensions API to create extensions that integrate code with the Lambda execution environment." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Lambda" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="" /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/runtimes-extensions-api.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/runtimes-extensions-api.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/runtimes-extensions-api.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/runtimes-extensions-api.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/runtimes-extensions-api.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/runtimes-extensions-api.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/runtimes-extensions-api.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/runtimes-extensions-api.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/runtimes-extensions-api.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/runtimes-extensions-api.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-extensions-api.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-extensions-api.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/runtimes-extensions-api.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/runtimes-extensions-api.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/runtimes-extensions-api.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/runtimes-extensions-api.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/runtimes-extensions-api.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lambda/latest/dg/runtimes-extensions-api.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html" hreflang="x-default" /><meta name="feedback-item" content="Lambda" /><meta name="this_doc_product" content="AWS Lambda" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lambda'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Lambda Extensions API" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Lambda Extensions API - AWS Lambda</title><meta name="pdf" content="/pdfs/lambda/latest/dg/lambda-dg.pdf#runtimes-extensions-api" /><meta name="rss" content="lambda-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html" /><meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing,Lambda extensions,Lambda function monitoring,Lambda extensions partners,Lambda external extensions,Lambda internal extensions,extensions,runtime,init,invoke,shutdown" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Lambda extensions",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-extensions.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Lambda Extensions API",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-extensions.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lambda/latest/dg/lambda-dg.pdf#runtimes-extensions-api" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div><div id="page-toc-src"><a href="#runtimes-extensions-api-lifecycle">Lambda execution environment
        lifecycle</a><a href="#runtimes-extensions-registration-api">Extensions API reference</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="runtimes-extensions-api">Lambda Extensions API</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Lambda function authors use extensions to integrate Lambda with their preferred tools for monitoring,
    observability, security, and governance. Function authors can use extensions from AWS, <a href="./extensions-api-partners.html">AWS Partners</a>, and
    open-source projects. For more information on using extensions, see <a href="http://aws.amazon.com/blogs/aws/getting-started-with-using-your-favorite-operational-tools-on-aws-lambda-extensions-are-now-generally-available/" rel="noopener noreferrer" target="_blank"><span>Introducing AWS Lambda Extensions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the AWS
    Compute Blog. This section describes how to use the Lambda Extensions API, the Lambda execution environment lifecycle, and the Lambda Extensions API reference. </p><div class="mediaobject">
     
      <img src="/images/lambda/latest/dg/images/telemetry-api-concept-diagram.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      The Extensions API and the Telemetry API connect Lambda and external extensions.&#xA;    " style="max-width:100%" />
     
     
  </div><p>As an extension author, you can use the Lambda Extensions API to integrate deeply into the Lambda <a href="./lambda-runtime-environment.html">execution environment</a>. Your extension can register for function and execution
    environment lifecycle events. In response to these events, you can start new processes, run logic, and control and
    participate in all phases of the Lambda lifecycle: initialization, invocation, and shutdown. In addition, you can use
    the <a href="./runtimes-logs-api.html">Runtime Logs API</a> to receive a stream of logs.</p><p>An extension runs as an independent process in the execution environment and can continue to run after the
    function invocation is fully processed. Because extensions run as processes, you can write them in a different
    language than the function. We recommend that you implement extensions using a compiled language. In this case, the
    extension is a self-contained binary that is compatible with supported runtimes. All <a href="./lambda-runtimes.html">Lambda runtimes</a> support extensions. If you use a non-compiled language, ensure that you include
    a compatible runtime in the extension. </p><p>Lambda also supports <em>internal extensions</em>. An internal extension runs as a separate thread in
    the runtime process. The runtime starts and stops the internal extension. An alternative way to integrate with the Lambda environment is to
    use language-specific <a href="./runtimes-modify.html">environment variables and wrapper scripts</a>. You can use
    these to configure the runtime environment and modify the startup behavior of the runtime process.</p><p>You can add extensions to a function in two ways. For a function deployed as a <a href="./gettingstarted-package.html#gettingstarted-package-zip">.zip file archive</a>, you deploy your extension as a <a href="./chapter-layers.html">layer</a>. For a function defined as a container image, you add <a href="./extensions-configuration.html#invocation-extensions-images">the extensions</a> to your container image.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>For example extensions and wrapper scripts, see <a href="https://github.com/aws-samples/aws-lambda-extensions" rel="noopener noreferrer" target="_blank"><span>AWS Lambda Extensions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on
      the AWS Samples GitHub repository.</p></div></div><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#runtimes-extensions-api-lifecycle">Lambda execution environment
        lifecycle</a></li><li><a href="#runtimes-extensions-registration-api">Extensions API reference</a></li></ul></div>
    <h2 id="runtimes-extensions-api-lifecycle">Lambda execution environment
        lifecycle</h2>
    
    <p>The lifecycle of the execution environment includes the following phases:</p>
      <div class="itemizedlist">
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code"><b>Init</b></code>: In this phase, Lambda creates or
            unfreezes an execution environment with the configured resources, downloads the code for the function and
            all layers, initializes any extensions, initializes the runtime, and then runs the function’s initialization
            code (the code outside the main handler). The <code class="code">Init</code> phase happens either during the first
            invocation, or in advance of function invocations if you have enabled <a href="./provisioned-concurrency.html">provisioned concurrency</a>.</p>
          <p>The <code class="code">Init</code> phase is split into three sub-phases: <code class="code">Extension init</code>, 
          <code class="code">Runtime init</code>, and <code class="code">Function init</code>. These sub-phases ensure that all extensions and the runtime complete their setup tasks before the function code runs.</p>
        </li><li class="listitem">
          <p><code class="code"><b>Invoke</b></code>: In this phase, Lambda invokes the function handler.
            After the function runs to completion, Lambda prepares to handle another function
            invocation.</p>
        </li><li class="listitem">
          <p><code class="code"><b>Shutdown</b></code>: This phase is triggered if the Lambda function does not
            receive any invocations for a period of time. In the <code class="code">Shutdown</code> phase, Lambda shuts down
            the runtime, alerts the extensions to let them stop cleanly, and then removes the environment. Lambda
            sends a <code class="code">Shutdown</code> event to each extension, which tells the extension that the environment is about
            to be shut down.</p>
        </li></ul></div>
    <p>Each phase starts with an event from Lambda to the runtime and to all registered extensions. The runtime and
      each extension signal completion by sending a <code class="code">Next</code> API request. Lambda freezes the execution
      environment when each process has completed and there are no pending events.</p>
    <div class="mediaobject">
       
        <img src="/images/lambda/latest/dg/images/Overview-Full-Sequence.png" class="aws-docs-img-whiteBg aws-docs-img-padding" style="max-width:100%" />
       
    </div>
    <p> </p>
    <div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#runtimes-extensions-api-reg">Init phase</a></li><li><a href="#runtimes-lifecycle-invoke">Invoke phase</a></li><li><a href="#runtimes-lifecycle-shutdown">Shutdown phase</a></li><li><a href="#runtimes-extensions-registration-api-e">Permissions and
          configuration</a></li><li><a href="#runtimes-extensions-api-failure">Failure handling</a></li><li><a href="#runtimes-extensions-api-trbl">Troubleshooting extensions</a></li></ul></div>
     
      <h3 id="runtimes-extensions-api-reg">Init phase</h3>
      <p>During the <code class="code">Extension init</code> phase, each extension needs to register with
        Lambda to receive events. Lambda uses the full file name of the extension to validate that the
        extension has completed the bootstrap sequence. Therefore, each <code class="code">Register</code> API
        call must include the <code class="code">Lambda-Extension-Name</code> header with the full file name of
        the extension.</p>
      <p>You can register up to 10 extensions for a function. This limit is enforced through the
          <code class="code">Register</code> API call.</p>
      <p>After each extension registers, Lambda starts the <code class="code">Runtime init</code> phase. The
        runtime process calls <code class="code">functionInit</code> to start the <code class="code">Function init</code>
        phase.</p>
      <p>The <code class="code">Init</code> phase completes after the runtime and each registered extension
        indicate completion by sending a <code class="code">Next</code> API request.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Extensions can complete their initialization at any point in the <code class="code">Init</code>
          phase.</p></div></div>
      <div class="mediaobject">
         
          <img src="/images/lambda/latest/dg/images/Init-Phase.png" class="aws-docs-img-whiteBg aws-docs-img-padding" style="max-width:100%" />
         
      </div>
     
     
      <h3 id="runtimes-lifecycle-invoke">Invoke phase</h3>
      <p>When a Lambda function is invoked in response to a <code class="code">Next</code> API request, Lambda
        sends an <code class="code">Invoke</code> event to the runtime and to each extension that is registered
        for the <code class="code">Invoke</code> event.</p>
      <p>During the invocation, external extensions run in parallel with the function. They also continue running
        after the function has completed. This enables you to capture diagnostic information or to send logs, metrics,
        and traces to a location of your choice.</p>
      <p>After receiving the function response from the runtime, Lambda returns the response to the client, even if
        extensions are still running.</p>
      <p>The <code class="code">Invoke</code> phase ends after the runtime and all extensions signal that they
        are done by sending a <code class="code">Next</code> API request. </p>
      <div class="mediaobject">
         
          <img src="/images/lambda/latest/dg/images/Invoke-Phase.png" class="aws-docs-img-whiteBg aws-docs-img-padding" style="max-width:100%" />
         
      </div>
      <p><b>Event payload</b>: The event sent to the runtime (and the
        Lambda function) carries the entire request, headers (such as <code class="code">RequestId</code>), and
        payload. The event sent to each extension contains metadata that describes the event
        content. This lifecycle event includes the type of the event, the time that the function
        times out (<code class="code">deadlineMs</code>), the <code class="code">requestId</code>, the invoked function's
        Amazon Resource Name (ARN), and tracing headers.</p>
      <p>Extensions that want to access the function event body can use an in-runtime SDK that
        communicates with the extension. Function developers use the in-runtime SDK to send the
        payload to the extension when the function is invoked.</p>
      <p>Here is an example payload:</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "eventType": "INVOKE",
    "deadlineMs": 676051,
    "requestId": "3da1f2dc-3222-475e-9205-e2e6c6318895",
    "invokedFunctionArn": "arn:aws:lambda:us-east-1:123456789012:function:ExtensionTest",
    "tracing": <span>{</span>
        "type": "X-Amzn-Trace-Id",
        "value": "Root=1-5f35ae12-0c0fec141ab77a00bc047aa2;Parent=2be948a625588e32;Sampled=1"
    }
 }          </code></pre>
      <p><b>Duration limit</b>: The function's timeout setting limits the duration of the entire <code class="code">Invoke</code> phase. For example, if you set
        the function timeout as 360 seconds, the function and all extensions need to complete within 360 seconds. Note
        that there is no independent post-invoke phase. The duration is the sum of all invocation time (runtime +
        extensions) and is not calculated until the function and all extensions have finished running.</p>
      <p><b>Performance impact and extension overhead</b>: Extensions
        can impact function performance. As an extension author, you have control over the
        performance impact of your extension. For example, if your extension performs
        compute-intensive operations, the function's duration increases because the extension and
        the function code share the same CPU resources. In addition, if your extension performs
        extensive operations after the function invocation completes, the function duration
        increases because the <code class="code">Invoke</code> phase continues until all extensions signal that
        they are completed.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Lambda allocates CPU power in proportion to the function's memory setting. You might see increased
          execution and initialization duration at lower memory settings because the function and extension processes
          are competing for the same CPU resources. To reduce the execution and initialization duration, try increasing
          the memory setting.</p></div></div>
      <p>To help identify the performance impact introduced by extensions on the <code class="code">Invoke</code> phase, Lambda
        outputs the <code class="code">PostRuntimeExtensionsDuration</code> metric. This metric measures the cumulative time spent
        between the runtime <code class="code">Next</code> API request and the last extension <code class="code">Next</code> API request. To
        measure the increase in memory used, use the <code class="code">MaxMemoryUsed</code> metric. For more information about
        function metrics, see <a href="./monitoring-metrics.html">Working with Lambda function metrics</a>.</p>
      <p>Function developers can run different versions of their functions side by side to
        understand the impact of a specific extension. We recommend that extension authors publish
        expected resource consumption to make it easier for function developers to choose a suitable
        extension.</p>
     
     
      <h3 id="runtimes-lifecycle-shutdown">Shutdown phase</h3>
      <p>When Lambda is about to shut down the runtime, it sends a <code class="code">Shutdown</code> to each registered external extension. 
        Extensions can use this time for final cleanup tasks. The
          <code class="code">Shutdown</code> event is sent in response to a <code class="code">Next</code> API request.</p>
      <p><b>Duration limit</b>: The maximum duration of the
          <code class="code">Shutdown</code> phase depends on the configuration of registered extensions:</p>
      <div class="itemizedlist">
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>0 ms – A function with no registered extensions</p>
        </li><li class="listitem">
          <p>500 ms – A function with a registered internal extension</p>
        </li><li class="listitem">
          <p>2,000 ms – A function with one or more registered external extensions</p>
        </li></ul></div>
      <p>For a function with external extensions, Lambda reserves up to 300 ms (500 ms for a
        runtime with an internal extension) for the runtime process to perform a graceful shutdown.
        Lambda allocates the remainder of the 2,000 ms limit for external extensions to shut
        down.</p>
      <p>If the runtime or an extension does not respond to the <code class="code">Shutdown</code> event within the limit, Lambda
        ends the process using a <code class="code">SIGKILL</code> signal.</p>
      <div class="mediaobject">
         
          <img src="/images/lambda/latest/dg/images/Shutdown-Phase.png" class="aws-docs-img-whiteBg aws-docs-img-padding" style="max-width:100%" />
         
      </div>
      <p><b>Event payload</b>: The <code class="code">Shutdown</code> event contains
        the reason for the shutdown and the time remaining in milliseconds.</p>
      <p> The <code class="code">shutdownReason</code> includes the following values:</p>
      <div class="itemizedlist">
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>SPINDOWN – Normal shutdown</p>
        </li><li class="listitem">
          <p>TIMEOUT – Duration limit timed out</p>
        </li><li class="listitem">
          <p>FAILURE – Error condition, such as an <code class="code">out-of-memory</code> event</p>
        </li></ul></div>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
<span>{</span> 
  "eventType": "SHUTDOWN", 
  "shutdownReason": "reason for shutdown", 
  "deadlineMs": "the time and date that the function times out in Unix time milliseconds" 
}        
      </code></pre>
     
     
      <h3 id="runtimes-extensions-registration-api-e">Permissions and
          configuration</h3>
      <p>Extensions run in the same execution environment as the Lambda function. Extensions also
        share resources with the function, such as CPU, memory, and <code class="code">/tmp</code> disk storage.
        In addition, extensions use the same AWS Identity and Access Management (IAM) role and security context as the
        function.</p>
      <p><b>File system and network access permissions</b>: Extensions run in the same file
        system and network name namespace as the function runtime. This means that extensions need to be compatible with
        the associated operating system. If an extension requires any additional
        outbound
        network traffic rules, you must apply these rules to the function configuration.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Because the function code directory is read-only, extensions cannot modify the
          function code.</p></div></div>
      <p><b>Environment variables</b>: Extensions can access the
        function's <a href="./configuration-envvars.html">environment variables</a>, except for
        the following variables that are specific to the runtime process:</p>
      <div class="itemizedlist">
         
         
         
         
         
         
         
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">AWS_EXECUTION_ENV</code></p>
        </li><li class="listitem">
          <p><code class="code">AWS_LAMBDA_LOG_GROUP_NAME</code></p>
        </li><li class="listitem">
          <p><code class="code">AWS_LAMBDA_LOG_STREAM_NAME</code></p>
        </li><li class="listitem">
          <p><code class="code">AWS_XRAY_CONTEXT_MISSING</code></p>
        </li><li class="listitem">
          <p><code class="code">AWS_XRAY_DAEMON_ADDRESS</code></p>
        </li><li class="listitem">
          <p><code class="code">LAMBDA_RUNTIME_DIR</code></p>
        </li><li class="listitem">
          <p><code class="code">LAMBDA_TASK_ROOT</code></p>
        </li><li class="listitem">
          <p><code class="code">_AWS_XRAY_DAEMON_ADDRESS</code></p>
        </li><li class="listitem">
          <p><code class="code">_AWS_XRAY_DAEMON_PORT</code></p>
        </li><li class="listitem">
          <p><code class="code">_HANDLER</code></p>
        </li></ul></div>
     
     
      <h3 id="runtimes-extensions-api-failure">Failure handling</h3>
      <p><b>Initialization failures</b>: If an extension fails, Lambda
        restarts the execution environment to enforce consistent behavior and to encourage fail fast
        for extensions. Also, for some customers, the extensions must meet mission-critical needs
        such as logging, security, governance, and telemetry collection.</p>
      <p><b>Invoke failures</b> (such as out of memory, function
        timeout): Because extensions share resources with the runtime, memory exhaustion affects
        them. When the runtime fails, all extensions and the runtime itself participate in the
          <code class="code">Shutdown</code> phase. In addition, the runtime is restarted—either
        automatically as part of the current invocation, or via a deferred re-initialization
        mechanism.</p>
      <p>If there is a failure (such as a function timeout or runtime error) during
        <code class="code">Invoke</code>, the Lambda service performs a reset. The reset behaves like a
        <code class="code">Shutdown</code> event. First, Lambda shuts down the runtime, then it sends a
        <code class="code">Shutdown</code> event to each registered external extension. The event includes the
        reason for the shutdown. If this environment is used for a new invocation, the extension and
        runtime are re-initialized as part of the next invocation.</p>
      <div class="mediaobject">
         
          <img src="/images/lambda/latest/dg/images/Overview-Invoke-with-Error.png" class="aws-docs-img-whiteBg aws-docs-img-padding" style="max-width:100%" />
         
      </div>
      <p>For a more detailed explanation of the previous diagram, see
        <a href="./lambda-runtime-environment.html#runtimes-lifecycle-invoke-with-errors">Failures during the invoke phase</a>.</p>
      <p><b>Extension logs</b>: Lambda sends the log output of
        extensions to CloudWatch Logs. Lambda also generates an additional log event for each extension during
          <code class="code">Init</code>. The log event records the name and registration preference (event,
        config) on success, or the failure reason on failure.</p>
     
     
      <h3 id="runtimes-extensions-api-trbl">Troubleshooting extensions</h3>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>If a <code class="code">Register</code> request fails, make sure that the
              <code class="code">Lambda-Extension-Name</code> header in the <code class="code">Register</code> API call
            contains the full file name of the extension.</p>
        </li><li class="listitem">
          <p>If the <code class="code">Register</code> request fails for an internal extension, make sure that
            the request does not register for the <code class="code">Shutdown</code> event.</p>
        </li></ul></div>
     
   
    <h2 id="runtimes-extensions-registration-api">Extensions API reference</h2>
    <p>The OpenAPI specification for the extensions API version <b>2020-01-01</b> is available here: <a href="samples/extensions-api.zip" rel="noopener noreferrer" target="_blank">extensions-api.zip</a></p>
    <p>You can retrieve the value of the API endpoint from the
        <code class="code">AWS_LAMBDA_RUNTIME_API</code> environment variable. To send a <code class="code">Register</code>
      request, use the prefix <code class="code">2020-01-01/</code> before each API path. For example:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">http://$<span>{</span>AWS_LAMBDA_RUNTIME_API}/2020-01-01/extension/register </code></pre>
    <div class="highlights" id="inline-topiclist"><h6>API methods</h6><ul><li><a href="#extensions-registration-api-a">Register</a></li><li><a href="#extensions-api-next">Next</a></li><li><a href="#runtimes-extensions-init-error">Init error</a></li><li><a href="#runtimes-extensions-exit-error">Exit error</a></li></ul></div>
     
      <h3 id="extensions-registration-api-a">Register</h3>
      <p>During <code class="code">Extension init</code>, all extensions need to register with Lambda to
        receive events. Lambda uses the full file name of the extension to validate that the
        extension has completed the bootstrap sequence. Therefore, each <code class="code">Register</code> API
        call must include the <code class="code">Lambda-Extension-Name</code> header with the full file name of
        the extension.</p>
      <p>Internal extensions are started and stopped by the runtime process, so they are not
        permitted to register for the <code class="code">Shutdown</code> event.</p>
      <p><b>Path</b> – <code class="code">/extension/register</code></p>
      <p><b>Method</b> – <b>POST</b></p>
      <p><b>Request headers</b></p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">Lambda-Extension-Name</code> – The full file name of the extension.
            Required: yes. Type: string.</p>
        </li><li class="listitem">
          <p><code class="code">Lambda-Extension-Accept-Feature</code> – Use this to specify optional
            Extensions features during registration. Required: no. Type: comma separated string.
            Features available to specify using this setting:</p>
          <div class="itemizedlist">
             
          <ul class="itemizedlist"><li class="listitem">
              <p><code class="code">accountId</code> – If specified, the Extension registration
                response will contain the account ID associated with the Lambda function that
                you're registering the Extension for.</p>
            </li></ul></div>
        </li></ul></div>
      <div class="itemizedlist">
        <h6>Request body parameters</h6>
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">events</code> – Array of the events to register for. Required: no. Type:
            array of strings. Valid strings: <code class="code">INVOKE</code>, <code class="code">SHUTDOWN</code>.</p>
        </li></ul></div>
      <div class="itemizedlist">
        <h6>Response headers</h6>
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">Lambda-Extension-Identifier</code> – Generated unique agent identifier
            (UUID string) that is required for all subsequent requests.</p>
        </li></ul></div>
      <div class="itemizedlist">
        <h6>Response codes</h6>
         
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>200 – Response body contains the function name, function version, and handler
            name.</p>
        </li><li class="listitem">
          <p>400 – Bad Request</p>
        </li><li class="listitem">
          <p>403 – Forbidden</p>
        </li><li class="listitem">
          <p>500 – Container error. Non-recoverable state. Extension should exit
            promptly.</p>
        </li></ul></div>
      <div class="example"><h6>Example request body</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    'events': [ 'INVOKE', 'SHUTDOWN']
}             </code></pre></div></div>
      <div class="example"><h6>Example response body</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "functionName": "helloWorld",
    "functionVersion": "$LATEST",
    "handler": "lambda_function.lambda_handler"
}               </code></pre></div></div>
      <div class="example"><h6>Example response body with optional accountId feature</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "functionName": "helloWorld",
    "functionVersion": "$LATEST",
    "handler": "lambda_function.lambda_handler",
    "accountId": "123456789012"
}</code></pre></div></div>
     
     
      <h3 id="extensions-api-next">Next</h3>
      <p>Extensions send a <code class="code">Next</code> API request to receive the next event, which can be
        an <code class="code">Invoke</code> event or a <code class="code">Shutdown</code> event. The response body contains
        the payload, which is a JSON document that contains event data.</p>
      <p>The extension sends a <code class="code">Next</code> API request to signal that it is ready to
        receive new events. This is a blocking call.</p>
      <p>Do not set a timeout on the GET call, as the extension can be suspended for a period of
        time until there is an event to return.</p>
      <p><b>Path</b> – <code class="code">/extension/event/next</code></p>
      <p><b>Method</b> – <b>GET</b></p>
      <div class="itemizedlist">
        <h6>Request headers</h6>
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">Lambda-Extension-Identifier</code> – Unique identifier for extension (UUID
            string). Required: yes. Type: UUID string.</p>
        </li></ul></div>
      <div class="itemizedlist">
        <h6>Response headers</h6>
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">Lambda-Extension-Event-Identifier</code> – Unique identifier for the event (UUID
            string).</p>
        </li></ul></div>
      <div class="itemizedlist">
        <h6>Response codes</h6>
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>200 – Response contains information about the next event
              (<code class="code">EventInvoke</code> or <code class="code">EventShutdown</code>).</p>
        </li><li class="listitem">
          <p>403 – Forbidden</p>
        </li><li class="listitem">
          <p>500 – Container error. Non-recoverable state. Extension should exit
            promptly.</p>
        </li></ul></div>
     
     
      <h3 id="runtimes-extensions-init-error">Init error</h3>
      <p>The extension uses this method to report an initialization error to Lambda. Call it when
        the extension fails to initialize after it has registered. After Lambda receives the error,
        no further API calls succeed. The extension should exit after it receives the response from
        Lambda.</p>
      <p><b>Path</b> – <code class="code">/extension/init/error</code></p>
      <p><b>Method</b> – <b>POST</b></p>
      <div class="itemizedlist">
        <h6>Request headers</h6>
           
           
      <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">Lambda-Extension-Identifier</code> – Unique identifier for extension.
              Required: yes. Type: UUID string.</p>
          </li><li class="listitem">
            <p><code class="code">Lambda-Extension-Function-Error-Type</code> – Error type that the extension encountered.
              Required: yes. This header consists of a string value. Lambda accepts any string, but we recommend a format of
                &lt;category.reason&gt;. For example:</p>
                <div class="itemizedlist">
                   
                   
                   
                   
                <ul class="itemizedlist"><li class="listitem"><p>Extension.NoSuchHandler</p></li><li class="listitem"><p>Extension.APIKeyNotFound</p></li><li class="listitem"><p>Extension.ConfigInvalid</p></li><li class="listitem"><p>Extension.UnknownReason</p></li></ul></div>
          </li></ul></div>
      <div class="itemizedlist">
        <h6>Request body parameters</h6>
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">ErrorRequest</code> – Information about the error. Required: no. </p>
        </li></ul></div>
      
    <p>This field is a JSON object with the following structure:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      errorMessage: string (text description of the error),
      errorType: string,
      stackTrace: array of strings
}</code></pre>    
<p>Note that Lambda accepts any value for <code class="code">errorType</code>.</p>  
 <p>The following example shows a Lambda function error message in which the function could not parse the event data
    provided in the invocation.</p>
    <div class="example"><h6>Example Function error</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "errorMessage" : "Error parsing event data.",
      "errorType" : "InvalidEventDataException",
      "stackTrace": [ ]
}      </code></pre></div></div>

      <div class="itemizedlist">
        <h6>Response codes</h6>
         
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>202 – Accepted</p>
        </li><li class="listitem">
          <p>400 – Bad Request</p>
        </li><li class="listitem">
          <p>403 – Forbidden</p>
        </li><li class="listitem">
          <p>500 – Container error. Non-recoverable state. Extension should exit
            promptly.</p>
        </li></ul></div>
     
     
      <h3 id="runtimes-extensions-exit-error">Exit error</h3>
      <p>The extension uses this method to report an error to Lambda before exiting. Call it when
        you encounter an unexpected failure. After Lambda receives the error, no further API calls
        succeed. The extension should exit after it receives the response from Lambda.</p>
      <p><b>Path</b> – <code class="code">/extension/exit/error</code></p>
      <p><b>Method</b> – <b>POST</b></p>
      <div class="itemizedlist">
        <h6>Request headers</h6>
           
           
      <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">Lambda-Extension-Identifier</code> – Unique identifier for extension.
              Required: yes. Type: UUID string.</p>
          </li><li class="listitem">
            <p><code class="code">Lambda-Extension-Function-Error-Type</code> – Error type that the extension encountered.
              Required: yes. This header consists of a string value. Lambda accepts any string, but we recommend a format of
                &lt;category.reason&gt;. For example:</p>
                <div class="itemizedlist">
                   
                   
                   
                   
                <ul class="itemizedlist"><li class="listitem"><p>Extension.NoSuchHandler</p></li><li class="listitem"><p>Extension.APIKeyNotFound</p></li><li class="listitem"><p>Extension.ConfigInvalid</p></li><li class="listitem"><p>Extension.UnknownReason</p></li></ul></div>
          </li></ul></div>
      <div class="itemizedlist">
        <h6>Request body parameters</h6>
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">ErrorRequest</code> – Information about the error. Required: no.</p>
        </li></ul></div>
      
    <p>This field is a JSON object with the following structure:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      errorMessage: string (text description of the error),
      errorType: string,
      stackTrace: array of strings
}</code></pre>    
<p>Note that Lambda accepts any value for <code class="code">errorType</code>.</p>  
 <p>The following example shows a Lambda function error message in which the function could not parse the event data
    provided in the invocation.</p>
    <div class="example"><h6>Example Function error</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "errorMessage" : "Error parsing event data.",
      "errorType" : "InvalidEventDataException",
      "stackTrace": [ ]
}      </code></pre></div></div>

      <div class="itemizedlist">
        <h6>Response codes</h6>
         
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>202 – Accepted</p>
        </li><li class="listitem">
          <p>400 – Bad Request</p>
        </li><li class="listitem">
          <p>403 – Forbidden</p>
        </li><li class="listitem">
          <p>500 – Container error. Non-recoverable state. Extension should exit
            promptly.</p>
        </li></ul></div>
      <p> </p>
     
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./extensions-api-partners.html">Extensions partners</div><div id="next" class="next-link" accesskey="n" href="./telemetry-api.html">Telemetry API</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>