<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Custom Lambda runtimes - AWS Lambda</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="runtimes-custom" /><meta name="default_state" content="runtimes-custom" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" /><meta name="description" content="You can implement an AWS Lambda runtime in any programming language. A runtime is a program that runs a Lambda function's handler method when the function is invoked. You can include a runtime in your function's deployment package as an executable file named" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Lambda" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="" /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/runtimes-custom.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/runtimes-custom.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/runtimes-custom.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/runtimes-custom.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/runtimes-custom.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/runtimes-custom.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/runtimes-custom.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/runtimes-custom.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/runtimes-custom.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/runtimes-custom.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-custom.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-custom.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/runtimes-custom.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/runtimes-custom.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/runtimes-custom.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/runtimes-custom.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/runtimes-custom.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lambda/latest/dg/runtimes-custom.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" hreflang="x-default" /><meta name="feedback-item" content="Lambda" /><meta name="this_doc_product" content="AWS Lambda" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lambda'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Custom Lambda runtimes" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Custom Lambda runtimes - AWS Lambda</title><meta name="pdf" content="/pdfs/lambda/latest/dg/lambda-dg.pdf#runtimes-custom" /><meta name="rss" content="lambda-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-custom.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-custom.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-custom.html" /><meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing,languages,runtime,supported languages,linux distribution,linux environment" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Lambda runtimes",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Custom Lambda runtimes",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lambda/latest/dg/lambda-dg.pdf#runtimes-custom" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div><div id="page-toc-src"><a href="#runtimes-custom-use">Using a custom runtime</a><a href="#runtimes-custom-build">Building a custom runtime</a><a href="#runtimes-custom-response-streaming">Implementing response streaming in a custom
        runtime</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="runtimes-custom">Custom Lambda runtimes</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can implement an AWS Lambda runtime in any programming language. A runtime is a program
    that runs a Lambda function's handler method when the function is invoked. You can include a
    runtime in your function's deployment package as an executable file named
      <code>bootstrap</code>.</p><p>A runtime runs the function's setup code, reads the handler name from an environment
    variable, and reads invocation events from the Lambda runtime API. The runtime passes the event
    data to the function handler, and posts the response from the handler back to Lambda.</p><p>Your custom runtime runs in the standard Lambda <a href="./lambda-runtimes.html">execution environment</a>. It
    can be a shell script, a script in a language that's included in Amazon Linux, or a binary executable file that's compiled
    in Amazon Linux.</p><p>To get started with custom runtimes, see <a href="./runtimes-walkthrough.html">Tutorial – Publishing a custom runtime</a>. You can also explore a custom runtime implemented in C++ at <a href="https://github.com/awslabs/aws-lambda-cpp" rel="noopener noreferrer" target="_blank"><span>awslabs/aws-lambda-cpp</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on GitHub.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#runtimes-custom-use">Using a custom runtime</a></li><li><a href="#runtimes-custom-build">Building a custom runtime</a></li><li><a href="#runtimes-custom-response-streaming">Implementing response streaming in a custom
        runtime</a></li></ul></div>
    <h2 id="runtimes-custom-use">Using a custom runtime</h2>
    
    <p>To use a custom runtime, set your function's runtime to <code class="code">provided.al2</code>. The runtime can be included in
      your function's deployment package, or in a <a href="./chapter-layers.html">layer</a>.</p>
    <div class="example"><h6>Example function.zip</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">.
├── bootstrap
├── function.sh</code></pre></div></div>
    
    <p>If there's a file named <code>bootstrap</code> in your deployment package, Lambda runs that file.
      If not, Lambda looks for a runtime in the function's layers. If the bootstrap file isn't found or isn't executable,
      your function returns an error upon invocation.</p>
   
    <h2 id="runtimes-custom-build">Building a custom runtime</h2>
    
    <p>A custom runtime's entry point is an executable file named <code>bootstrap</code>. The bootstrap file
      can be the runtime, or it can invoke another file that creates the runtime. The following example uses a bundled
      version of Node.js to run a JavaScript runtime in a separate file named
      <code>runtime.js</code>.</p>
    <div class="example"><h6>Example bootstrap</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">#!/bin/sh
cd $LAMBDA_TASK_ROOT
./node-v11.1.0-linux-x64/bin/node runtime.js</code></pre></div></div>
    
    <p>Your runtime code is responsible for completing some initialization tasks. Then it
      processes invocation events in a loop until it's shut down. The initialization tasks run once
        <a href="./lambda-runtime-environment.html">per instance of the function</a> to prepare
      the environment to handle invocations.</p>
    <div class="itemizedlist">
      <h6>Initialization tasks</h6>
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>Retrieve settings</b> – Read environment variables to get details
          about the function and environment.</p>
        <div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">_HANDLER</code> – The location to the handler, from the function's configuration. The
              standard format is <code class="code"><code class="replaceable">file</code>.<code class="replaceable">method</code></code>, where
                <code class="code">file</code> is the name of the file without an extension, and <code class="code">method</code> is the name of a
              method or function that's defined in the file.</p>
          </li><li class="listitem">
            <p><code class="code">LAMBDA_TASK_ROOT</code> – The directory that contains the function code.</p>
          </li><li class="listitem">
            <p><code class="code">AWS_LAMBDA_RUNTIME_API</code> – The host and port of the runtime API.</p>
          </li></ul></div>
        <p>For a full list of available variables, see <a href="./configuration-envvars.html#configuration-envvars-runtime">Defined runtime environment variables</a>.</p>
      </li><li class="listitem">
        <p><b>Initialize the function</b> – Load the handler file and run any global
          or static code that it contains. Functions should create static resources like SDK clients and database
          connections once, and reuse them for multiple invocations.</p>
      </li><li class="listitem">
        <p><b>Handle errors</b> – If an error occurs, call the <a href="./runtimes-api.html#runtimes-api-initerror">initialization error</a> API and exit immediately.</p>
      </li></ul></div>
    
    <p>Initialization counts towards billed execution time and timeout. When an execution triggers the initialization
      of a new instance of your function, you can see the initialization time in the logs and <a href="./services-xray.html">AWS X-Ray trace</a>.</p>
    <div class="example"><h6>Example log</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">REPORT RequestId: f8ac1208... Init Duration: 48.26 ms   Duration: 237.17 ms   Billed Duration: 300 ms   Memory Size: 128 MB   Max Memory Used: 26 MB</code></pre></div></div>
    
    <p>While it runs, a runtime uses the <a href="./runtimes-api.html">Lambda runtime interface</a> to manage
      incoming events and report errors. After completing initialization tasks, the runtime processes incoming events in
      a loop. In your runtime code, perform the following steps in order.</p>
    <div class="itemizedlist">
      <h6>Processing tasks</h6>
       
       
       
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>Get an event</b> – Call the <a href="./runtimes-api.html#runtimes-api-next">next
            invocation</a> API to get the next event. The response body contains the event data. Response headers
          contain the request ID and other information.</p>
      </li><li class="listitem">
        <p><b>Propagate the tracing header</b> – Get the X-Ray tracing header from
          the <code class="code">Lambda-Runtime-Trace-Id</code> header in the API response. Set the <code class="code">_X_AMZN_TRACE_ID</code>
          environment variable locally with the same value. The X-Ray SDK uses this value to connect trace data between
          services.</p>
      </li><li class="listitem">
        <p><b>Create a context object</b> – Create an object with context
          information from environment variables and headers in the API response.</p>
      </li><li class="listitem">
        <p><b>Invoke the function handler</b> – Pass the event and context object to
          the handler.</p>
      </li><li class="listitem">
        <p><b>Handle the response</b> – Call the <a href="./runtimes-api.html#runtimes-api-response">invocation response</a> API to post the response from the handler.</p>
      </li><li class="listitem">
        <p><b>Handle errors</b> – If an error occurs, call the <a href="./runtimes-api.html#runtimes-api-invokeerror">invocation error</a> API.</p>
      </li><li class="listitem">
        <p><b>Cleanup</b> – Release unused resources, send data to other services,
          or perform additional tasks before getting the next event.</p>
      </li></ul></div>
    
    
    <p>You can include the runtime in your function's deployment package, or distribute the runtime separately in a
      function layer. For an example walkthrough, see <a href="./runtimes-walkthrough.html">Tutorial – Publishing a custom runtime</a>.</p>
   
    <h2 id="runtimes-custom-response-streaming">Implementing response streaming in a custom
        runtime</h2>
    <p>For response streaming functions, the <code class="code">response</code> and <code class="code">error</code>
      endpoints have slightly modified behavior that lets the runtime stream partial responses to
      the client and return payloads in chunks. For more information about the specific behavior,
      see the following:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">/runtime/invocation/AwsRequestId/response</code> – Propagates the
            <code class="code">Content-Type</code> header from the runtime to send to the client. Lambda returns
          the response payload in chunks via HTTP/1.1 chunked transfer encoding. The response stream can be a maximum 
          size of 20 MiB. To stream the response to Lambda, the runtime must:</p>
        <div class="itemizedlist">
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Set the <code class="code">Lambda-Runtime-Function-Response-Mode</code> HTTP header to
                <code class="code">streaming</code>.</p>
          </li><li class="listitem">
            <p>Set the <code class="code">Transfer-Encoding</code> header to <code class="code">chunked</code>.</p>
          </li><li class="listitem">
            <p>Write the response conforming to the HTTP/1.1 chunked transfer encoding
              specification.</p>
          </li><li class="listitem">
            <p>Close the underlying connection after it has successfully written the
              response.</p>
          </li></ul></div>
      </li><li class="listitem">
        <p><code class="code">/runtime/invocation/AwsRequestId/error</code> – The runtime can use this
          endpoint to report function or runtime errors to Lambda, which also accepts the
            <code class="code">Transfer-Encoding</code> header. This endpoint can only be called before the
          runtime begins sending an invocation response.</p>
      </li><li class="listitem">
        <p>Report midstream errors using error trailers in
            <code class="code">/runtime/invocation/AwsRequestId/response</code> – To report errors that
          occur after the runtime starts writing the invocation response, the runtime can optionally
          attach HTTP trailing headers named <code class="code">Lambda-Runtime-Function-Error-Type</code> and
            <code class="code">Lambda-Runtime-Function-Error-Body</code>. Lambda treats this as a successful
          response and forwards the error metadata that the runtime provides to the client. </p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>To attach trailing headers, the runtime must set the <code class="code">Trailer</code> header
            value at the beginning of the HTTP request. This is a requirement of the HTTP/1.1
            chunked transfer encoding specification.</p></div></div>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">Lambda-Runtime-Function-Error-Type</code> – The error type that the
              runtime encountered. This header consists of a string value. Lambda accepts any string,
              but we recommend a format of <code class="replaceable">&lt;category.reason&gt;</code>. For
              example, <code class="code">Runtime.APIKeyNotFound</code>.</p>
          </li><li class="listitem">
            <p><code class="code">Lambda-Runtime-Function-Error-Body</code> – Base64-encoded
              information about the error.</p>
          </li></ul></div>
      </li></ul></div>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./runtimes-api.html">Runtime API</div><div id="next" class="next-link" accesskey="n" href="./runtimes-walkthrough.html">Tutorial – Custom runtime</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-custom.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-custom.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>