<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Handling uniqueness with Lambda SnapStart - AWS Lambda</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="snapstart-uniqueness" /><meta name="default_state" content="snapstart-uniqueness" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/snapstart-uniqueness.html" /><meta name="description" content="To maintain randomness when working with Lambda SnapStart, use a CSPRNG and avoid caching random values during initialization." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Lambda" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="" /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/snapstart-uniqueness.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/snapstart-uniqueness.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/snapstart-uniqueness.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/snapstart-uniqueness.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/snapstart-uniqueness.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/snapstart-uniqueness.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/snapstart-uniqueness.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/snapstart-uniqueness.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/snapstart-uniqueness.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/snapstart-uniqueness.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/snapstart-uniqueness.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/snapstart-uniqueness.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/snapstart-uniqueness.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/snapstart-uniqueness.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/snapstart-uniqueness.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/snapstart-uniqueness.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/snapstart-uniqueness.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/snapstart-uniqueness.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/snapstart-uniqueness.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/snapstart-uniqueness.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lambda/latest/dg/snapstart-uniqueness.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/snapstart-uniqueness.html" hreflang="x-default" /><meta name="feedback-item" content="Lambda" /><meta name="this_doc_product" content="AWS Lambda" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lambda'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Handling uniqueness with Lambda SnapStart" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Handling uniqueness with Lambda SnapStart - AWS Lambda</title><meta name="pdf" content="/pdfs/lambda/latest/dg/lambda-dg.pdf#snapstart-uniqueness" /><meta name="rss" content="lambda-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/snapstart-uniqueness.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/snapstart-uniqueness.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/snapstart-uniqueness.html" /><meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing,cold start,java initialization,Lambda function startup time,Lambda Java performance optimization,Lambda Java function cold start,RNG with SnapStart,random number generation with snapshot,Lambda SnapStart randomness,cryptography SnapStart" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Improving startup performance with Lambda SnapStart",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/snapstart.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Handling uniqueness with Lambda SnapStart",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/snapstart.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lambda/latest/dg/lambda-dg.pdf#snapstart-uniqueness" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div><div id="page-toc-src"><a href="#snapstart-caching-unique">Avoid saving state that depends on uniqueness during
        initialization</a><a href="#snapstart-csprng">Use CSPRNGs</a><a href="#snapstart-scanning">Scanning tool</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="snapstart-uniqueness">Handling uniqueness with Lambda SnapStart</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>When invocations scale up on a SnapStart function, Lambda uses a single initialized snapshot to resume multiple execution environments. If your initialization code generates unique content that is included in the snapshot, then the content might not be unique when it is reused across execution environments. To maintain uniqueness when using SnapStart, you must generate unique content after initialization. This includes unique IDs, unique secrets, and entropy that's used to generate pseudorandomness.</p><p>We recommend the following best practices to help you maintain uniqueness in your code. Lambda also provides an
    open-source <a href="#snapstart-scanning">SnapStart scanning tool</a> to help check for code that assumes
    uniqueness. If you generate unique data during the initialization phase, then you can use a <a href="./snapstart-runtime-hooks.html">runtime hook</a> to restore uniqueness. With runtime
    hooks, you can run specific
    code immediately before Lambda takes a snapshot or immediately after Lambda resumes a function from a snapshot.</p>
      <h2 id="snapstart-caching-unique">Avoid saving state that depends on uniqueness during
        initialization</h2>
      <p>During the <a href="./lambda-runtime-environment.html#runtimes-lifecycle-ib">initialization phase</a> of your function, avoid caching data that's intended to be unique, such as generating a unique ID for logging. Instead, we recommend that you generate unique data inside your function handler or use a <a href="./snapstart-runtime-hooks.html">runtime hook</a>.</p>
      <div class="example"><h6>Example  – Generating a unique ID in function handler</h6><div class="example-contents"><p>The following example demonstrates how to generate a UUID in the function handler.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="java ">import java.util.UUID;
  public class Handler implements RequestHandler&lt;String, String&gt; <span>{</span>
    private static UUID uniqueSandboxId = null;
    @Override
    public String handleRequest(String event, Context context) <span>{</span>
      <code class="userinput">if (uniqueSandboxId == null)
        uniqueSandboxId = UUID.randomUUID();</code>
      System.out.println("Unique Sandbox Id: " + uniqueSandboxId);
      return "Hello, World!";
    }
  }</code></pre></div></div>
     
      <h2 id="snapstart-csprng">Use cryptographically secure pseudorandom number generators (CSPRNGs)</h2>
      <p>If your application depends on randomness, we recommend that you use cryptographically secure random number
      generators (CSPRNGs). The Lambda managed runtime for Java includes two built-in CSPRNGs (OpenSSL 1.0.2 and
        <code class="code">java.security.SecureRandom</code>) that automatically maintain randomness with SnapStart. Software that
      always gets random numbers from <code class="code">/dev/random</code> or <code class="code">/dev/urandom</code> also maintains randomness
      with SnapStart.</p>
      <div class="example"><h6>Example  – java.security.SecureRandom</h6><div class="example-contents"><p>The following example uses <code class="code">java.security.SecureRandom</code>, which generates unique number sequences even when the function is restored from a snapshot.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="java ">import java.security.SecureRandom;
  public class Handler implements RequestHandler&lt;String, String&gt; <span>{</span>
    <code class="userinput">private static SecureRandom rng = new SecureRandom();</code>
    @Override
    public String handleRequest(String event, Context context) <span>{</span>
      for (int i = 0; i &lt; 10; i++) <span>{</span>
        System.out.println(rng.next());
      }
      return "Hello, World!";
    }
  }</code></pre></div></div>
     
      <h2 id="snapstart-scanning">SnapStart scanning tool</h2>
      <p>Lambda provides a scanning tool to help you check for code that assumes uniqueness. The SnapStart scanning
      tool is an open-source <a href="https://spotbugs.github.io/" rel="noopener noreferrer" target="_blank"><span>SpotBugs</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> plugin that runs a static
      analysis against a set of rules. The scanning tool helps identify potential code implementations that might break
      assumptions regarding uniqueness. For installation instructions and a list of checks that the scanning tool
      performs, see the <a href="https://github.com/aws/aws-lambda-snapstart-java-rules" rel="noopener noreferrer" target="_blank"><span>aws-lambda-snapstart-java-rules</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> repository on GitHub.</p>
      <p>To learn more about handling uniqueness with SnapStart, see <a href="https://aws.amazon.com/blogs/compute/starting-up-faster-with-aws-lambda-snapstart/" rel="noopener noreferrer" target="_blank"><span>Starting up faster with AWS Lambda SnapStart</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the AWS Compute Blog.</p><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./snapstart-activate.html">Activating SnapStart</div><div id="next" class="next-link" accesskey="n" href="./snapstart-runtime-hooks.html">Runtime hooks</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/snapstart-uniqueness.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/snapstart-uniqueness.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>