<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Connecting outbound networking to resources in a VPC - AWS Lambda</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="configuration-vpc" /><meta name="default_state" content="configuration-vpc" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html" /><meta name="description" content="Learn how to configure a Lambda function to access Amazon VPC resources." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Lambda" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="" /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/configuration-vpc.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/configuration-vpc.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/configuration-vpc.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/configuration-vpc.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/configuration-vpc.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/configuration-vpc.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/configuration-vpc.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/configuration-vpc.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/configuration-vpc.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/configuration-vpc.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/configuration-vpc.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/configuration-vpc.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/configuration-vpc.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/configuration-vpc.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/configuration-vpc.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/configuration-vpc.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/configuration-vpc.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lambda/latest/dg/configuration-vpc.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html" hreflang="x-default" /><meta name="feedback-item" content="Lambda" /><meta name="this_doc_product" content="AWS Lambda" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lambda'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Connecting outbound networking to resources in a VPC" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Connecting outbound networking to resources in a VPC - AWS Lambda</title><meta name="pdf" content="/pdfs/lambda/latest/dg/lambda-dg.pdf#configuration-vpc" /><meta name="rss" content="lambda-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html" /><meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing,configure Lambda function,create Lambda function,function vpc,connect function to vpc,vpc configuration,vpc settings,vpc permissions,vpc subnet,network interface" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Configuring AWS Lambda functions",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-functions.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Connecting outbound networking to resources in a VPC",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-functions.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lambda/latest/dg/lambda-dg.pdf#configuration-vpc" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div><div id="page-toc-src"><a href="#vpc-managing-eni">Managing VPC connections</a><a href="#vpc-permissions">Execution role and user permissions</a><a href="#vpc-configuring">Configuring VPC access (console)</a><a href="#vpc-configuring-api">Configuring VPC access (API)</a><a href="#vpc-conditions">Using IAM condition keys for VPC settings</a><a href="#vpc-internet">Internet and service access for VPC-connected functions</a><a href="#vpc-tutorials">VPC tutorials</a><a href="#vpc-samples">Sample VPC configurations</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="configuration-vpc">Connecting outbound networking to resources in a VPC</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can configure a Lambda function to connect to private subnets in a virtual private cloud (VPC) in your AWS
    account. Use Amazon Virtual Private Cloud (Amazon VPC) to create a private network for resources such as databases, cache instances, or
    internal services. Connect your function to the VPC to access private resources while the function is running. This section provides a summary of Lambda VPC connections. For details about VPC networking in Lambda, see <a href="./foundation-networking.html">Private networking with VPC</a>.</p><div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>To configure your Lambda function to access a VPC and subnet, you can use the Lambda Console or the API.</p><p>Refer to the <code class="code">VpcConfig</code> section in <a href="./API_CreateFunction.html">CreateFunction</a> to configure your function. See <a href="#vpc-configuring">Configuring VPC access (console)</a> and <a href="#vpc-configuring-api">Configuring VPC access (API)</a> for detailed steps.</p></div></div><p>When you connect a function to a VPC, Lambda assigns your function to a Hyperplane ENI (elastic network
    interface) for each subnet in your function's VPC configuration. Lambda creates a Hyperplane ENI the first time a
    unique subnet and security group combination is defined for a VPC-enabled function in an account.</p><p>While Lambda creates a Hyperplane ENI, you can't perform additional operations that target the function, such as
      <a href="./configuration-versions.html">creating versions</a> or updating the function's code. For new
    functions, you can't invoke the function until its state changes from <code class="code">Pending</code> to <code class="code">Active</code>.
    For existing functions, you can still invoke an earlier version while the update is in progress. For details about
    the Hyperplane ENI lifecycle, see <a href="./foundation-networking.html#foundation-nw-eni">Lambda Hyperplane ENIs</a>.</p><p>Lambda functions can't connect directly to a VPC with <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/dedicated-instance.html"> dedicated instance tenancy</a>. To connect to resources
    in a dedicated VPC, <a href="https://aws.amazon.com/premiumsupport/knowledge-center/lambda-dedicated-vpc/" rel="noopener noreferrer" target="_blank"><span>peer it to a
      second VPC with default tenancy</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p><div class="highlights" id="inline-topiclist"><h6>Sections</h6><ul><li><a href="#vpc-managing-eni">Managing VPC connections</a></li><li><a href="#vpc-permissions">Execution role and user permissions</a></li><li><a href="#vpc-configuring">Configuring VPC access (console)</a></li><li><a href="#vpc-configuring-api">Configuring VPC access (API)</a></li><li><a href="#vpc-conditions">Using IAM condition keys for VPC settings</a></li><li><a href="#vpc-internet">Internet and service access for VPC-connected functions</a></li><li><a href="#vpc-tutorials">VPC tutorials</a></li><li><a href="#vpc-samples">Sample VPC configurations</a></li></ul></div>
    <h2 id="vpc-managing-eni">Managing VPC connections</h2>
    <p>Multiple functions can share a network interface, if the functions share the same subnet and security group.
      Connecting additional functions to the same VPC configuration (subnet and security group) that has an existing
      Lambda-managed network interface is much quicker than creating a new network interface.  </p>
    <p>If your functions aren't active for a long period of time, Lambda reclaims its network interfaces, and the
      functions become <code class="code">Idle</code>. To reactivate an idle function, invoke it. This invocation fails, and the
      function enters a <code class="code">Pending</code> state again until a network interface is available.</p>
    <p>If you update your function to access a different VPC, it terminates connectivity from the Hyperplane ENI to
      the previous VPC. The process to update the connectivity to a new VPC can take several minutes. During this time,
      Lambda connects function invocations to the previous VPC. After the update is complete, new invocations start using
      the new VPC and the Lambda  function is no longer connected to the older VPC.</p>
    <p>For short-lived operations, such as DynamoDB queries, the latency overhead of setting up a TCP connection
      might be greater than the operation itself. To ensure connection reuse for short-lived/infrequently invoked
      functions, we recommend that you use <em>TCP keep-alive</em> for connections that were
      created during your function initialization, to avoid creating new connections for subsequent invokes. For more
      information on reusing connections using keep-alive, refer to <a href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/node-reusing-connections.html">Lambda
        documentation on reusing connections</a><a href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/node-reusing-connections.html">.</a></p>
 
   
    <h2 id="vpc-permissions">Execution role and user permissions</h2>
    
    <p>Lambda uses your function's permissions to create and manage network interfaces. To connect to a VPC, your
      function's <a href="./lambda-intro-execution-role.html">execution role</a> must have the following
      permissions:</p>
    <div class="itemizedlist">
      <h6>Execution role permissions</h6>
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>ec2:CreateNetworkInterface</b></p>
      </li><li class="listitem">
        <p><b>ec2:DescribeNetworkInterfaces</b> – This action only works if it's allowed on all resources (<code class="code">"Resource": "*"</code>).</p>
      </li><li class="listitem">
        <p><b>ec2:DeleteNetworkInterface</b> – If you don't specify a resource ID for <b>DeleteNetworkInterface</b> in the execution role, your function may not be able 
          to access the VPC. Either specify a unique resource ID, or include all resource IDs, for example, <code class="code">"Resource": "arn:aws:ec2:us-west-2:123456789012:*/*"</code>.</p>
      </li></ul></div>
    <p>These permissions are included in the AWS managed policy <b>AWSLambdaVPCAccessExecutionRole</b>. Note that these permissions
      are required only to create ENIs, not to invoke your VPC function. In other words, you are still able to invoke your VPC function successfully
      even if you remove these permissions from your execution role. To completely disassociate your Lambda function from the VPC, update the
      function's VPC configuration settings using the console or the <a href="./API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a> API.</p>
    <p>When you configure VPC connectivity, Lambda uses your permissions to verify network resources. To configure a
      function to connect to a VPC, your user needs the following permissions:</p>
    <div class="itemizedlist">
      <h6>User permissions</h6>
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>ec2:DescribeSecurityGroups</b></p>
      </li><li class="listitem">
        <p><b>ec2:DescribeSubnets</b></p>
      </li><li class="listitem">
        <p><b>ec2:DescribeVpcs</b></p>
      </li></ul></div>
   
    <h2 id="vpc-configuring">Configuring VPC access (console)</h2>
    <p>If your <a href="#vpc-conditions">IAM permissions</a> allow you only to create Lambda functions that
      connect to your VPC, you must configure the VPC when you create the function. If your IAM permissions allow you
      to create functions that aren't connected to your VPC, you can add the VPC configuration after you create the
      function.</p>
    <div class="procedure"><h6>To configure a VPC when you create a function</h6><ol><li><p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> of the Lambda console.</p></li><li>
        <p>Choose <b>Create function</b>.</p>
      </li><li>
        <p>Under <b>Basic information</b>, for <b>Function name</b>, enter a name for
          your function.</p>
      </li><li>
        <p>Expand <b>Advanced settings</b>.</p>
      </li><li>
        <p>Select <b>Enable VPC</b>, and then choose the VPC that you want the function to access.</p>
      </li><li>
        <p>(Optional) To allow <a href="./foundation-networking.html#foundation-nw-ipv6">outbound IPv6 traffic</a>, select <b>Allow IPv6 traffic for dual-stack subnets</b>.</p>
      </li><li>
        <p>Choose subnets and security groups. If you selected <b>Allow IPv6 traffic for dual-stack subnets</b>, all selected subnets must have an IPv4 CIDR block and an IPv6 CIDR block.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>To access private resources, connect your function to private subnets. If your function needs internet
            access, use <a href="#vpc-internet">network address translation (NAT)</a>. Connecting a function to
            a public subnet doesn't give it internet access or a public IP address.</p></div></div>
      </li><li>
        <p>Choose <b>Create function</b>.</p>
      </li></ol></div>
    
    <div class="procedure"><h6>To configure a VPC for an existing function</h6><ol><li><p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> of the Lambda console.</p></li><li>
        <p>Choose a function.</p>
      </li><li>
		<p>Choose <b>Configuration</b> and then choose <b>VPC</b>.</p>
	  </li><li>
        <p>Under <b>VPC</b>, choose <b>Edit</b>.</p>
      </li><li>
        <p>Choose the VPC that you want the function to access.</p>
      </li><li>
       <p>(Optional) To allow <a href="./foundation-networking.html#foundation-nw-ipv6">outbound IPv6 traffic</a>, select <b>Allow IPv6 traffic for dual-stack subnets</b>.</p>
      </li><li>
        <p>Choose subnets and security groups. If you selected <b>Allow IPv6 traffic for dual-stack subnets</b>, all selected subnets must have an IPv4 CIDR block and an IPv6 CIDR block.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>To access private resources, connect your function to private subnets. If your function needs internet
            access, use <a href="#vpc-internet">network address translation (NAT)</a>. Connecting a function to
            a public subnet doesn't give it internet access or a public IP address.</p></div></div>
      </li><li>
        <p>Choose <b>Save</b>.</p>
      </li></ol></div>
   
    <h2 id="vpc-configuring-api">Configuring VPC access (API)</h2>
    <p>To connect a Lambda function to a VPC, you can use the following API operations:</p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="./API_CreateFunction.html">CreateFunction</a></p>
      </li><li class="listitem">
        <p><a href="./API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a></p>
      </li></ul></div>
    <p>To create a function and connect it to a VPC using the AWS Command Line Interface (AWS CLI), you can use the
        <code class="code">create-function</code> command with the <a href="./API_VpcConfig.html">vpc-config</a> option. The following example creates a
      function with a VPC connection. The function has access to two subnets and one security group and allows <a href="./foundation-networking.html#foundation-nw-ipv6">outbound IPv6 traffic</a>.</p>
    
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda create-function --function-name my-function \
--runtime nodejs18.x --handler index.js --zip-file fileb://function.zip \
--role arn:aws:iam::<code class="replaceable">123456789012</code>:role/<code class="replaceable">lambda-role</code> \
--vpc-config Ipv6AllowedForDualStack=<code class="replaceable">true</code>,SubnetIds=<code class="replaceable">subnet-071f712345678e7c8,subnet-07fd123456788a036</code>,SecurityGroupIds=<code class="replaceable">sg-085912345678492fb</code></code></code></pre>
    
    <p>To connect an existing function to a VPC, use the <code class="code">update-function-configuration</code> command with the
        <code class="code">vpc-config</code> option.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-configuration --function-name my-function \
--vpc-config SubnetIds=<code class="replaceable">subnet-071f712345678e7c8,subnet-07fd123456788a036</code>,SecurityGroupIds=<code class="replaceable">sg-085912345678492fb</code></code></code></pre>
    
    <p>To disconnect your function from a VPC, update the function configuration with an empty list of subnets and
      security groups.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-configuration --function-name my-function \
--vpc-config SubnetIds=[],SecurityGroupIds=[]</code></code></pre>
   
    <h2 id="vpc-conditions">Using IAM condition keys for VPC settings</h2>
    <p>You can use Lambda-specific condition keys for VPC settings to provide additional permission controls for your
      Lambda functions. For example, you can require that all functions in your organization are connected to a VPC. You
      can also specify the subnets and security groups that the function's users can and can't use.</p>
    <p>Lambda supports the following condition keys in IAM policies:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>lambda:VpcIds</b> – Allow or deny one or more VPCs.</p>
      </li><li class="listitem">
        <p><b>lambda:SubnetIds</b> – Allow or deny one or more subnets.</p>
      </li><li class="listitem">
        <p><b>lambda:SecurityGroupIds</b> – Allow or deny one or more security
          groups.</p>
      </li></ul></div>
    <p>The Lambda API operations <a href="./API_CreateFunction.html">CreateFunction</a> and <a href="./API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a> support these condition keys. For
      more information about using condition keys in IAM policies, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition.html">IAM JSON Policy Elements:
        Condition</a> in the <em>IAM User Guide</em>.</p>
    <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>If your function already includes a VPC configuration from a previous API request, you can send an
          <code class="code">UpdateFunctionConfiguration</code> request without the VPC configuration.</p></div></div>
     
      <h3 id="vpc-condition-examples">Example policies with condition keys for VPC settings</h3>
      <p>The following examples demonstrate how to use condition keys for VPC settings. After you create a policy
        statement with the desired restrictions, append the policy statement for the target user or role.</p>
       
        <h4 id="vpc-condition-example-1">Ensure that users deploy only VPC-connected functions</h4>
        <p>To ensure that all users deploy only VPC-connected functions, you can deny function create and update
          operations that don't include a valid VPC ID. </p>
        <p>Note that VPC ID is not an input parameter to the <code class="code">CreateFunction</code> or
            <code class="code">UpdateFunctionConfiguration</code> request. Lambda retrieves the VPC ID value based on the subnet and
          security group parameters.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "EnforceVPCFunction",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "Null": <span>{</span>
           "lambda:VpcIds": "true"
        }
      }
    }
  ]
}
        </code></pre>
       
       
        <h4 id="vpc-condition-example-2">Deny users access to specific VPCs, subnets, or security
            groups</h4>
        <p>To deny users access to specific VPCs, use <code class="code">StringEquals</code> to check the value of the
            <code class="code">lambda:VpcIds</code> condition. The following example denies users access to <code class="code">vpc-1</code> and
            <code class="code">vpc-2</code>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "EnforceOutOfVPC",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
            "lambda:VpcIds": ["vpc-1", "vpc-2"]
        }
      }
    } 
        </code></pre>
        <p>To deny users access to specific subnets, use <code class="code">StringEquals</code> to check the value of the
            <code class="code">lambda:SubnetIds</code> condition. The following example denies users access to <code class="code">subnet-1</code>
          and <code class="code">subnet-2</code>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceOutOfSubnet",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAnyValue:StringEquals": <span>{</span>
            "lambda:SubnetIds": ["subnet-1", "subnet-2"]
        }
      }
    }
       </code></pre>
        <p>To deny users access to specific security groups, use <code class="code">StringEquals</code> to check the value of the
            <code class="code">lambda:SecurityGroupIds</code> condition. The following example denies users access to
            <code class="code">sg-1</code> and <code class="code">sg-2</code>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceOutOfSecurityGroups",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAnyValue:StringEquals": <span>{</span>
            "lambda:SecurityGroupIds": ["sg-1", "sg-2"]
        }
      }
    }
  ]
}
        </code></pre>
       
       
        <h4 id="vpc-condition-example-3">Allow users to create and update functions with specific VPC
            settings</h4>
        <p>To allow users to access specific VPCs, use <code class="code">StringEquals</code> to check the value of the
            <code class="code">lambda:VpcIds</code> condition. The following example allows users to access <code class="code">vpc-1</code> and
            <code class="code">vpc-2</code>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "EnforceStayInSpecificVpc",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Allow",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
            "lambda:VpcIds": ["vpc-1", "vpc-2"]
        }
      }
    }
        </code></pre>
        <p>To allow users to access specific subnets, use <code class="code">StringEquals</code> to check the value of the
            <code class="code">lambda:SubnetIds</code> condition. The following example allows users to access <code class="code">subnet-1</code>
          and <code class="code">subnet-2</code>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceStayInSpecificSubnets",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Allow",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAllValues:StringEquals": <span>{</span>
            "lambda:SubnetIds": ["subnet-1", "subnet-2"]
        }
      }
    }
      </code></pre>
        <p>To allow users to access specific security groups, use <code class="code">StringEquals</code> to check the value of the
            <code class="code">lambda:SecurityGroupIds</code> condition. The following example allows users to access
            <code class="code">sg-1</code> and <code class="code">sg-2</code>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceStayInSpecificSecurityGroup",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Allow",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAllValues:StringEquals": <span>{</span>
            "lambda:SecurityGroupIds": ["sg-1", "sg-2"]
        }
      }
    }
  ]
} 
        </code></pre>
       
     
   
    <h2 id="vpc-internet">Internet and service access for VPC-connected functions</h2>
    <p>By default, Lambda runs your functions in a secure VPC with access to AWS services and the internet. Lambda
      owns this VPC, which isn't connected to your account's <a href="https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html">default VPC</a>. When you connect a function to a VPC in your
      account, the function can't access the internet unless your VPC provides access.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Several AWS services offer <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html">VPC
          endpoints</a>. You can use VPC endpoints to connect to AWS services from within a VPC without internet
        access.</p></div></div>
    <p>Internet access from a private subnet requires network address translation (NAT). To give your function access
      to the internet, route outbound traffic to a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html">NAT gateway</a> in a public subnet. The NAT gateway has a
      public IP address and can connect to the internet through the VPC's internet gateway. An idle NAT gateway connection
      will <a href="https://docs.aws.amazon.com/vpc/latest/userguide/nat-gateway-troubleshooting.html#nat-gateway-troubleshooting-timeout">
      time out after 350 seconds.</a> For more information, see
      <a href="https://aws.amazon.com/premiumsupport/knowledge-center/internet-access-lambda-function/" rel="noopener noreferrer" target="_blank"><span>How do I give
      internet access to my Lambda function in a VPC?</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
   
    <h2 id="vpc-tutorials">VPC tutorials</h2>
    <p>In the following tutorials, you connect a Lambda function to resources in your VPC.</p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/rds-lambda-tutorial.html">Tutorial: Using a Lambda function to access Amazon RDS in an Amazon VPC</a></p>
      </li><li class="listitem">
        <p><a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/mem-ug/Lambda.html">Tutorial: Configuring a Lambda function to access Amazon ElastiCache in an Amazon VPC</a></p>
      </li></ul></div>
   
    <h2 id="vpc-samples">Sample VPC configurations</h2>
    
    <p>You can use the following sample AWS CloudFormation templates to create VPC configurations to use with Lambda functions.
      There are two templates available in this guide's GitHub repository:</p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/main/templates/vpc-private.yaml" rel="noopener noreferrer" target="_blank"><span>vpc-private.yaml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A VPC with
          two private subnets and VPC endpoints for Amazon Simple Storage Service (Amazon S3) and Amazon DynamoDB. Use this template to create a VPC for
          functions that don't need internet access. This configuration supports use of Amazon S3 and DynamoDB with the AWS
          SDKs, and access to database resources in the same VPC over a local network connection.</p>
      </li><li class="listitem">
        <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/main/templates/vpc-privatepublic.yaml" rel="noopener noreferrer" target="_blank"><span>vpc-privatepublic.yaml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
          – A VPC with two private subnets, VPC endpoints, a public subnet with a NAT gateway, and an internet
          gateway. Internet-bound traffic from functions in the private subnets is routed to the NAT gateway using a
          route table.</p>
      </li></ul></div>
    <p>To create a VPC using a template, on the AWS CloudFormation console <a href="https://console.aws.amazon.com/cloudformation/home#/stacks" rel="noopener noreferrer" target="_blank"><span>Stacks page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, choose <b>Create
        stack</b>, and then follow the instructions in the <b>Create stack</b> wizard.</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./configuration-envvars.html">Environment variables</div><div id="next" class="next-link" accesskey="n" href="./configuration-vpc-endpoints.html">Inbound networking</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>