<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Instrumenting Node.js code in AWS Lambda - AWS Lambda</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="nodejs-tracing" /><meta name="default_state" content="nodejs-tracing" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/nodejs-tracing.html" /><meta name="description" content="Learn how to instrument Node.js Lambda functions using X-Ray tracing." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Lambda" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="" /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/nodejs-tracing.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/nodejs-tracing.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/nodejs-tracing.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/nodejs-tracing.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/nodejs-tracing.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/nodejs-tracing.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/nodejs-tracing.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/nodejs-tracing.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/nodejs-tracing.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/nodejs-tracing.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/nodejs-tracing.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/nodejs-tracing.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/nodejs-tracing.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/nodejs-tracing.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/nodejs-tracing.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/nodejs-tracing.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/nodejs-tracing.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/nodejs-tracing.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/nodejs-tracing.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/nodejs-tracing.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lambda/latest/dg/nodejs-tracing.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/nodejs-tracing.html" hreflang="x-default" /><meta name="feedback-item" content="Lambda" /><meta name="this_doc_product" content="AWS Lambda" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lambda'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Instrumenting Node.js code in AWS Lambda" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Instrumenting Node.js code in AWS Lambda - AWS Lambda</title><meta name="pdf" content="/pdfs/lambda/latest/dg/lambda-dg.pdf#nodejs-tracing" /><meta name="rss" content="lambda-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/nodejs-tracing.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/nodejs-tracing.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/nodejs-tracing.html" /><meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing,js function,javascript Lambda,javascript define function,javascript Lambda function,Lambda node.js,trace Node.js Lambda function,instrument Node.js Lambda function,Lambda Node.js tracing,ADOT Lambda Node.js,Lambda Node.js telemetry" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Building Lambda functions with Node.js",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-nodejs.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Instrumenting Node.js code in AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-nodejs.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lambda/latest/dg/lambda-dg.pdf#nodejs-tracing" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div><div id="page-toc-src"><a href="#nodejs-adot">Using ADOT to instrument your Node.js functions</a><a href="#nodejs-xray-sdk">Using the X-Ray SDK to instrument your Node.js functions</a><a href="#nodejs-tracing-console">Activating tracing with the Lambda console</a><a href="#nodejs-tracing-api">Activating tracing with the Lambda API</a><a href="#nodejs-tracing-cloudformation">Activating tracing with AWS CloudFormation</a><a href="#nodejs-tracing-interpretation">Interpreting an X-Ray trace</a><a href="#nodejs-tracing-layers">Storing runtime dependencies in a layer (X-Ray SDK)</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="nodejs-tracing">Instrumenting Node.js code in AWS Lambda</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Lambda integrates with AWS X-Ray to help you trace, debug, and optimize Lambda applications. You can use X-Ray
    to trace a request as it traverses resources in your application, which may include Lambda functions and other AWS
    services.</p><p>To send tracing data to X-Ray, you can use one of two SDK libraries:</p><div class="itemizedlist">
     
     
  <ul class="itemizedlist"><li class="listitem">
      <p><a href="http://aws.amazon.com/otel" rel="noopener noreferrer" target="_blank"><span>AWS Distro for OpenTelemetry (ADOT)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A secure, production-ready,
        AWS-supported distribution of the OpenTelemetry (OTel) SDK.</p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-nodejs.html">AWS X-Ray SDK for Node.js</a> – An SDK
        for generating and sending trace data to X-Ray.</p>
    </li></ul></div><p>Each of the SDKs offer ways to send your telemetry data to the X-Ray service.
    You can then use X-Ray to view, filter, and gain insights into your application's performance metrics to identify
    issues and opportunities for optimization.</p><div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>The X-Ray and Powertools for AWS Lambda SDKs are part of a tightly integrated instrumentation solution offered by AWS. 
The ADOT Lambda Layers are part of an industry-wide standard for tracing instrumentation that collect more data in general, but may not be 
suited for all use cases. You can implement end-to-end tracing in X-Ray using either solution. To learn more about choosing between them, see 
<a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-instrumenting-your-app.html#xray-instrumenting-choosing">Choosing between the AWS 
Distro for Open Telemetry and X-Ray SDKs</a>.</p></div></div><div class="highlights" id="inline-topiclist"><h6>Sections</h6><ul><li><a href="#nodejs-adot">Using ADOT to instrument your Node.js functions</a></li><li><a href="#nodejs-xray-sdk">Using the X-Ray SDK to instrument your Node.js functions</a></li><li><a href="#nodejs-tracing-console">Activating tracing with the Lambda console</a></li><li><a href="#nodejs-tracing-api">Activating tracing with the Lambda API</a></li><li><a href="#nodejs-tracing-cloudformation">Activating tracing with AWS CloudFormation</a></li><li><a href="#nodejs-tracing-interpretation">Interpreting an X-Ray trace</a></li><li><a href="#nodejs-tracing-layers">Storing runtime dependencies in a layer (X-Ray SDK)</a></li></ul></div>
    <h2 id="nodejs-adot">Using ADOT to instrument your Node.js functions</h2>
    <p>ADOT provides fully managed Lambda <a href="./gettingstarted-concepts.html#gettingstarted-concepts-layer">layers</a> that package
      everything you need to collect telemetry data using the OTel SDK. By consuming this layer, you can instrument your
      Lambda functions without having to modify any function code. You can also configure your layer to do custom
      initialization of OTel. For more information, see <a href="https://aws-otel.github.io/docs/getting-started/lambda#custom-configuration-for-the-adot-collector-on-lambda" rel="noopener noreferrer" target="_blank"><span>Custom configuration for the ADOT Collector on Lambda</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the ADOT documentation.</p>
    <p>For Node.js runtimes, you can add the <b>AWS managed Lambda layer for ADOT
      Javascript</b> to automatically instrument your functions. For detailed instructions on how to
      add this layer, see <a href="https://aws-otel.github.io/docs/getting-started/lambda/lambda-js" rel="noopener noreferrer" target="_blank"><span>AWS
      Distro for OpenTelemetry Lambda Support for JavaScript</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the ADOT documentation.</p>
   
    <h2 id="nodejs-xray-sdk">Using the X-Ray SDK to instrument your Node.js functions</h2>
    <p>To record details about calls that your Lambda function makes to other resources in your application,
      you can also use the AWS X-Ray SDK for Node.js. To get the SDK, add the <code class="code">aws-xray-sdk-core</code> package to
      your application's dependencies.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/blank-nodejs/package.json" rel="noopener noreferrer" target="_blank"><span>blank-nodejs/package.json</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "name": "blank-nodejs",
  "version": "1.0.0",
  "private": true,
  "devDependencies": <span>{</span>
    "aws-sdk": "2.631.0",
    "jest": "25.4.0"
  },
  "dependencies": <span>{</span>
    <code class="userinput">"aws-xray-sdk-core": "1.1.2"</code>
  },
  "scripts": <span>{</span>
    "test": "jest"
  }
}</code></pre></div></div>
    <p>To instrument AWS SDK clients, wrap the <code class="code">aws-sdk</code> library with the <code class="code">captureAWS</code>
      method.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/blank-nodejs/function/index.js" rel="noopener noreferrer" target="_blank"><span>blank-nodejs/function/index.js</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> –
        Tracing an AWS SDK client</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="javascript "><code class="userinput">const AWSXRay = require('aws-xray-sdk-core')
const AWS = AWSXRay.captureAWS(require('aws-sdk'))</code>

// Create client outside of handler to reuse
const lambda = new AWS.Lambda()

// Handler
exports.handler = async function(event, context) <span>{</span>
  event.Records.forEach(record =&gt; <span>{</span>
  ...</code></pre></div></div>
    <p>The Lambda runtime sets some environment variables to configure the X-Ray SDK. For example, Lambda sets
      <code class="code">AWS_XRAY_CONTEXT_MISSING</code> to <code class="code">LOG_ERROR</code> to avoid throwing runtime errors from the
      X-Ray SDK. To set a custom context missing strategy, override the environment variable in your function
      configuration to have no value, and then you can set the context missing strategy programmatically.</p>
    <div class="example"><h6>Example initialization code</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">const AWSXRay = require('aws-xray-sdk-core');

// Configure the context missing strategy to do nothing
AWSXRay.setContextMissingStrategy(() =&gt; <span>{</span>});</code></pre></div></div>
    <p>For more information, see <a href="./configuration-envvars.html">Using Lambda environment variables</a>.</p>
    <p>After you add the correct dependencies and make the necessary code changes, activate tracing in your
      function's configuration via the Lambda console or the API.</p>
   
    <h2 id="nodejs-tracing-console">Activating tracing with the Lambda console</h2>
    <p>To toggle active tracing on your Lambda function with the console, follow these steps:</p>
    <div class="procedure"><h6>To turn on active tracing</h6><ol><li><p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> of the Lambda console.</p></li><li>
      <p>Choose a function.</p>
    </li><li><p>Choose <b>Configuration</b> and then choose <b>Monitoring and operations tools</b>.</p></li><li><p>Choose <b>Edit</b>.</p></li><li>
      <p>Under <b>X-Ray</b>, toggle on <b>Active tracing</b>.</p>
    </li><li>
      <p>Choose <b>Save</b>.</p>
    </li></ol></div>
   
    <h2 id="nodejs-tracing-api">Activating tracing with the Lambda API</h2>
    <p>Configure tracing on your Lambda function with the AWS CLI or AWS SDK, use the following API operations:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem"><p><a href="./API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a></p></li><li class="listitem"><p><a href="./API_GetFunctionConfiguration.html">GetFunctionConfiguration</a></p></li><li class="listitem"><p><a href="./API_CreateFunction.html">CreateFunction</a></p></li></ul></div>
    <p>The following example AWS CLI command enables active tracing on a function named
    <b>my-function</b>.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-configuration --function-name my-function \
--tracing-config Mode=Active</code></code></pre>
    <p>Tracing mode is part of the version-specific configuration when you publish a version of your function.
    You can't change the tracing mode on a published version.</p>
   
    <h2 id="nodejs-tracing-cloudformation">Activating tracing with AWS CloudFormation</h2>
    <p>To activate tracing on an <code class="code">AWS::Lambda::Function</code> resource in an AWS CloudFormation template, use the
        <code class="code">TracingConfig</code> property.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/templates/function-inline.yml" rel="noopener noreferrer" target="_blank"><span>function-inline.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> –
        Tracing configuration</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html">AWS::Lambda::Function</a>
    Properties:
      <code class="userinput">TracingConfig:
        Mode: Active</code>
      ...</code></pre></div></div>
    <p>For an AWS Serverless Application Model (AWS SAM) <code class="code">AWS::Serverless::Function</code> resource, use the <code class="code">Tracing</code>
      property.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/blank-nodejs/template.yml" rel="noopener noreferrer" target="_blank"><span>template.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Tracing
        configuration</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html">AWS::Serverless::Function</a>
    Properties:
      <code class="userinput">Tracing: Active</code>
      ...</code></pre></div></div>
   
    <h2 id="nodejs-tracing-interpretation">Interpreting an X-Ray trace</h2>
    <p>Your function needs permission to upload trace data to X-Ray. When you activate tracing in the Lambda
    console, Lambda adds the required permissions to your function's <a href="./lambda-intro-execution-role.html">execution role</a>. Otherwise, add the <a href="https://console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess" rel="noopener noreferrer" target="_blank"><span>AWSXRayDaemonWriteAccess</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> policy to the execution role.</p>
    <p>After you've configured active tracing, you can observe specific requests
    through your application. The <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-servicegraph">
    X-Ray service graph</a> shows information about your application and all its components. The following example from
    the <a href="./samples-errorprocessor.html">error processor</a> sample application shows an application with two functions.
    The primary function processes events and sometimes returns errors. The second function at the top processes errors that appear
    in the first's log group and uses the AWS SDK to call X-Ray, Amazon Simple Storage Service (Amazon S3), and Amazon CloudWatch Logs.</p>
    <div class="mediaobject">
       
        <img src="/images/lambda/latest/dg/images/sample-errorprocessor-servicemap.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        A diagram that shows two separate applications and their respective service maps in X-Ray&#xA;      " />
       
       
    </div>
    <p>X-Ray doesn't trace all requests to your application. X-Ray applies a sampling algorithm
    to ensure that tracing is efficient, while still providing a representative sample of all requests. The sampling rate is
    1 request per second and 5 percent of additional requests.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>You cannot configure the X-Ray sampling rate for your functions.</p></div></div>
    <p>When using active tracing, Lambda records 2 segments per trace, which creates
  two nodes on the service graph. The following image highlights these two nodes for the primary function from the
  <a href="./samples-errorprocessor.html">error processor sample application</a>.</p>
  <div class="mediaobject">
     
      <img src="/images/lambda/latest/dg/images/xray-servicemap-function.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      An X-Ray service map with a single function.&#xA;    " />
     
     
  </div>
  <p>The first node on the left represents the Lambda service, which receives the invocation request. The second
    node represents your specific Lambda function. The following example shows a trace with these two segments. Both
    are named <b>my-function</b>, but one has an origin of <code class="code">AWS::Lambda</code> and the other has
    origin <code class="code">AWS::Lambda::Function</code>.</p>
  <div class="mediaobject">
     
      <img src="/images/lambda/latest/dg/images/nodejs-xray-timeline.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        An X-Ray trace that shows latency across each subsegment of a specific Lambda invocation.&#xA;      " />
     
       
  </div>
  <p>This example expands the function segment to show its three subsegments:</p>
  <div class="itemizedlist">
     
     
     
  <ul class="itemizedlist"><li class="listitem">
      <p><b>Initialization</b> – Represents time spent loading your function and
        running <a href="./foundation-progmodel.html">initialization code</a>. This subsegment
        only appears for the first event that each instance of your function processes.</p>
    </li><li class="listitem">
      <p><b>Invocation</b> – Represents the time spent running your handler code.</p>
    </li><li class="listitem">
      <p><b>Overhead</b> – Represents the time the Lambda runtime spends preparing
        to handle the next event.</p>
    </li></ul></div>
    <p>You can also instrument HTTP clients, record SQL queries, and create custom subsegments
      with annotations and metadata. For more information, see the <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-nodejs.html">AWS X-Ray SDK for Node.js</a> in the
      <em>AWS X-Ray Developer Guide</em>.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Pricing</h6></div><div class="awsdocs-note-text"><p>You can use X-Ray tracing for free each month up to a certain limit as part of the AWS Free Tier. Beyond that threshold, X-Ray charges for trace storage and
      retrieval. For more information, see <a href="http://aws.amazon.com/xray/pricing/" rel="noopener noreferrer" target="_blank"><span>AWS X-Ray pricing</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></div></div>
   
    <h2 id="nodejs-tracing-layers">Storing runtime dependencies in a layer (X-Ray SDK)</h2>
    <p>If you use the X-Ray SDK to instrument AWS SDK clients your function code, your deployment package can become
      quite large. To avoid uploading runtime dependencies every time you update your function code, package the X-Ray SDK in a
        <a href="./chapter-layers.html">Lambda layer</a>.</p>
    <p>The following example shows an <code class="code">AWS::Serverless::LayerVersion</code> resource that stores the
      AWS X-Ray SDK for Node.js.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/blank-nodejs/template.yml" rel="noopener noreferrer" target="_blank"><span>template.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Dependencies
        layer</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html">AWS::Serverless::Function</a>
    Properties:
      CodeUri: function/.
      Tracing: Active
      <code class="userinput">Layers:
        - !Ref libs</code>
      ...
  <code class="userinput">libs:
    Type: <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-layerversion.html">AWS::Serverless::LayerVersion</a>
    Properties:
      LayerName: blank-nodejs-lib
      Description: Dependencies for the blank sample app.
      ContentUri: lib/.
      CompatibleRuntimes:
        - nodejs16.x</code></code></pre></div></div>
     <p>With this configuration, you update the library layer only if you change your runtime dependencies.
    Since the function deployment package contains only your code, this can help reduce upload times.</p>
    
    <p>Creating a layer for dependencies requires build changes to generate the layer archive prior to deployment.
      For a working example, see the <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/blank-nodejs" rel="noopener noreferrer" target="_blank"><span>blank-nodejs</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> sample
      application.</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./nodejs-exceptions.html">Errors</div><div id="next" class="next-link" accesskey="n" href="./lambda-typescript.html">Building with TypeScript</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/nodejs-tracing.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/nodejs-tracing.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>