<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Using AWS Lambda with Amazon API Gateway - AWS Lambda</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="services-apigateway" /><meta name="default_state" content="services-apigateway" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html" /><meta name="description" content="How to use AWS Lambda with Amazon API Gateway." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Lambda" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="" /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/services-apigateway.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lambda/latest/dg/services-apigateway.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/services-apigateway.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/services-apigateway.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/services-apigateway.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lambda/latest/dg/services-apigateway.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/services-apigateway.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lambda/latest/dg/services-apigateway.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/services-apigateway.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lambda/latest/dg/services-apigateway.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/services-apigateway.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/services-apigateway.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/services-apigateway.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/services-apigateway.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/services-apigateway.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/services-apigateway.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/services-apigateway.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lambda/latest/dg/services-apigateway.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html" hreflang="x-default" /><meta name="feedback-item" content="Lambda" /><meta name="this_doc_product" content="AWS Lambda" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lambda'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Using AWS Lambda with Amazon API Gateway" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Using AWS Lambda with Amazon API Gateway - AWS Lambda</title><meta name="pdf" content="/pdfs/lambda/latest/dg/lambda-dg.pdf#services-apigateway" /><meta name="rss" content="lambda-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-apigateway.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-apigateway.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-apigateway.html" /><meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing,triggers,event,event object,other AWS service,using Lambda with DynamoDB database,using Lambda with SQS queue service,using Lambda with SNS notification service,lambda api gateway,create lambda function endpoint" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Lambda",
        "item" : "https://docs.aws.amazon.com/lambda/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Using AWS Lambda with other services",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Using AWS Lambda with Amazon API Gateway",
        "item" : "https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lambda/latest/dg/lambda-dg.pdf#services-apigateway" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div><div id="page-toc-src"><a href="#apigateway-add">Adding an endpoint to your Lambda function</a><a href="#apigateway-proxy">Proxy integration</a><a href="#apigateway-example-event">Event format</a><a href="#apigateway-types-transforms">Response format</a><a href="#apigateway-permissions">Permissions</a><a href="#services-apigateway-errors">Handling errors with an API Gateway API</a><a href="#services-apigateway-apitypes">Choosing an API type</a><a href="#services-apigateway-samples">Sample applications</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="services-apigateway">Using AWS Lambda with Amazon API Gateway</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can create a web API with an HTTP endpoint for your Lambda function by using Amazon API Gateway. API Gateway provides tools
    for creating and documenting web APIs that route HTTP requests to Lambda functions. You can secure access to your API
    with authentication and authorization controls. Your APIs can serve traffic over the internet or can be accessible
    only within your VPC.</p><p>Resources in your API define one or more methods, such as GET or POST. Methods have an integration that routes
    requests to a Lambda function or another integration type. You can define each resource and method individually, or
    use special resource and method types to match all requests that fit a pattern. A <em>proxy
      resource</em> catches all paths beneath a resource. The <code class="code">ANY</code> method catches all HTTP
    methods.</p><p>This section explains general information on how to choose an API type, add an endpoint to your Lambda function, and information on events, permissions, responses, and error handling.</p><div class="highlights"><h6>Sections</h6><ul><li><a href="#apigateway-add">Adding an endpoint to your Lambda function</a></li><li><a href="#apigateway-proxy">Proxy integration</a></li><li><a href="#apigateway-example-event">Event format</a></li><li><a href="#apigateway-types-transforms">Response format</a></li><li><a href="#apigateway-permissions">Permissions</a></li><li><a href="#services-apigateway-errors">Handling errors with an API Gateway API</a></li><li><a href="#services-apigateway-apitypes">Choosing an API type</a></li><li><a href="#services-apigateway-samples">Sample applications</a></li><li><a href="./services-apigateway-tutorial.html">Tutorial: Using Lambda with API Gateway</a></li><li><a href="./services-apigateway-template.html">AWS SAM template for an API Gateway application</a></li></ul></div>
    <h2 id="apigateway-add">Adding an endpoint to your Lambda function</h2>
    <div class="procedure"><h6>To add a public endpoint to your Lambda function</h6><ol><li><p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> of the Lambda console.</p></li><li>
        <p>Choose a function.</p>
      </li><li>
        <p>Under <b>Function overview</b>, choose <b>Add trigger</b>.</p>
      </li><li>
        <p>Select <b>API Gateway</b>.</p>
      </li><li>
        <p>Choose <b>Create an API</b> or <b>Use an existing API</b>.</p>
        <ol><li>
            <p><b>New API:</b> For <b>API type</b>, choose <b>HTTP API</b>. For more information, see <a href="#services-apigateway-apitypes">API types</a>.</p>
            </li><li>
            <p><b>Existing API:</b> Select the API from the dropdown menu or enter the API ID (for example, r3pmxmplak).</p>
          </li></ol>
      </li><li>
        <p>For <b>Security</b>, choose <b>Open</b>.</p>
      </li><li>
        <p>Choose <b>Add</b>.</p>
      </li></ol></div>
   
    <h2 id="apigateway-proxy">Proxy integration</h2>
    
    <p>API Gateway APIs are comprised of stages, resources, methods, and integrations. The stage and resource determine the
      path of the endpoint:</p>
    <div class="itemizedlist">
      <h6>API path format</h6>
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">/prod/</code> – The <code class="code">prod</code> stage and root resource.</p>
      </li><li class="listitem">
        <p><code class="code">/prod/user</code> – The <code class="code">prod</code> stage and <code class="code">user</code> resource.</p>
      </li><li class="listitem">
        <p><code class="code">/dev/<span>{</span>proxy+}</code> – Any route in the <code class="code">dev</code> stage.</p>
      </li><li class="listitem">
        <p><code class="code">/</code> – (HTTP APIs) The default stage and root resource.</p>
      </li></ul></div>
    <p>A Lambda integration maps a path and HTTP method combination to a Lambda function. You can configure API Gateway to pass
      the body of the HTTP request as-is (custom integration), or to encapsulate the request body in a document that
      includes all of the request information including headers, resource, path, and method.</p>
   
    <h2 id="apigateway-example-event">Event format</h2>
      
    <p>Amazon API Gateway invokes your function <a href="./invocation-sync.html">synchronously</a> with an event that contains
      a JSON representation of the HTTP request. For a custom integration, the event is the body of the request. For a
      proxy integration, the event has a defined structure. The following example shows a proxy event from an API Gateway REST
      API.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/nodejs-apig/event.json" rel="noopener noreferrer" target="_blank"><span>event.json</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> API Gateway proxy event (REST API)</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "resource": "/",
      "path": "/",
      "httpMethod": "GET",
      "requestContext": <span>{</span>
          "resourcePath": "/",
          "httpMethod": "GET",
          "path": "/Prod/",
          ...
      },
      "headers": <span>{</span>
          "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
          "accept-encoding": "gzip, deflate, br",
          "Host": "70ixmpl4fl.execute-api.us-east-2.amazonaws.com",
          "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36",
          "X-Amzn-Trace-Id": "Root=1-5e66d96f-7491f09xmpl79d18acf3d050",
          ...
      },
      "multiValueHeaders": <span>{</span>
          "accept": [
              "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"
          ],
          "accept-encoding": [
              "gzip, deflate, br"
          ],
          ...
      },
      "queryStringParameters": null,
      "multiValueQueryStringParameters": null,
      "pathParameters": null,
      "stageVariables": null,
      "body": null,
      "isBase64Encoded": false
  }</code></pre></div></div>
   
    <h2 id="apigateway-types-transforms">Response format</h2>
    
    <p>API Gateway waits for a response from your function and relays the result to the caller. For a custom integration, you
      define an integration response and a method response to convert the output from the function to an HTTP response.
      For a proxy integration, the function must respond with a representation of the response in a specific
      format.</p>
    <p>The following example shows a response object from a Node.js function. The response object represents a
      successful HTTP response that contains a JSON document.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/nodejs-apig/function/index.js" rel="noopener noreferrer" target="_blank"><span>index.js</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Proxy integration
        response object (Node.js)</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">var response = <span>{</span>
      "statusCode": 200,
      "headers": <span>{</span>
        "Content-Type": "application/json"
      },
      "isBase64Encoded": false,
      "multiValueHeaders": <span>{</span> 
        "X-Custom-Header": ["My value", "My other value"],
      },
      "body": "<span>{</span>\n  \"TotalCodeSize\": 104330022,\n  \"FunctionCount\": 26\n}"
    }</code></pre></div></div>
    <p>The Lambda runtime serializes the response object into JSON and sends it to the API. The API parses the response
      and uses it to create an HTTP response, which it then sends to the client that made the original request.</p>
    <div class="example"><h6>Example HTTP response</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">&lt; HTTP/1.1 200 OK
  &lt; Content-Type: application/json
  &lt; Content-Length: 55
  &lt; Connection: keep-alive
  &lt; x-amzn-RequestId: 32998fea-xmpl-4268-8c72-16138d629356
  &lt; X-Custom-Header: My value
  &lt; X-Custom-Header: My other value
  &lt; X-Amzn-Trace-Id: Root=1-5e6aa925-ccecxmplbae116148e52f036
  &lt;
  <span>{</span>
    "TotalCodeSize": 104330022,
    "FunctionCount": 26
  }</code></pre></div></div>
   
    <h2 id="apigateway-permissions">Permissions</h2>
    
    <p>Amazon API Gateway gets permission to invoke your function from the function's <a href="./access-control-resource-based.html">resource-based policy</a>. You can grant invoke permission to an
      entire API, or grant limited access to a stage, resource, or method.</p>
    
    <p>When you add an API to your function by using the Lambda console, using the API Gateway console, or in an AWS SAM
      template, the function's resource-based policy is updated automatically. The following is an example function policy.</p>
    <div class="example"><h6>Example function policy</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Id": "default",
  "Statement": [
    <span>{</span>
      "Sid": "nodejs-apig-functiongetEndpointPermissionProd-BWDBXMPLXE2F",
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": "apigateway.amazonaws.com"
      },
      "Action": "lambda:InvokeFunction",
      "Resource": "arn:aws:lambda:us-east-2:111122223333:function:nodejs-apig-function-1G3MXMPLXVXYI",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:SourceAccount": "111122223333"
        },
        "ArnLike": <span>{</span>
          "aws:SourceArn": "arn:aws:execute-api:us-east-2:111122223333:ktyvxmpls1/*/GET/"
        }
      }
    }
  ]
}</code></pre></div></div>
    
    <p>You can manage function policy permissions manually with the following API operations:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="./API_AddPermission.html">AddPermission</a></p>
      </li><li class="listitem">
        <p><a href="./API_RemovePermission.html">RemovePermission</a></p>
      </li><li class="listitem">
        <p><a href="./API_GetPolicy.html">GetPolicy</a></p>
      </li></ul></div>
    <p>To grant invocation permission to an existing API, use the <code class="code">add-permission</code> command.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda add-permission --function-name my-function \
--statement-id apigateway-get --action lambda:InvokeFunction \
--principal apigateway.amazonaws.com \
--source-arn "arn:aws:execute-api:us-east-2:123456789012:mnh1xmpli7/default/GET/"</code></code></pre>
    
    <p>You should see the following output:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Statement": "<span>{</span>\"Sid\":\"apigateway-test-2\",\"Effect\":\"Allow\",\"Principal\":<span>{</span>\"Service\":\"apigateway.amazonaws.com\"},\"Action\":\"lambda:InvokeFunction\",\"Resource\":\"arn:aws:lambda:us-east-2:123456789012:function:my-function\",\"Condition\":<span>{</span>\"ArnLike\":<span>{</span>\"AWS:SourceArn\":\"arn:aws:execute-api:us-east-2:123456789012:mnh1xmpli7/default/GET\"}}}"
}</code></pre>
    
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If your function and API are in different regions, the region identifier in the source ARN must match the
        region of the function, not the region of the API. When API Gateway invokes a function, it uses a resource ARN that is
        based on the ARN of the API, but modified to match the function's region.</p></div></div>
    <p>The source ARN in this example grants permission to an integration on the GET method of the root resource in
      the default stage of an API, with ID <code class="code">mnh1xmpli7</code>. You can use an asterisk in the source ARN to grant
      permissions to multiple stages, methods, or resources.</p>
    <div class="itemizedlist">
      <h6>Resource patterns</h6>
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">mnh1xmpli7/*/GET/*</code> – GET method on all resources in all stages.</p>
      </li><li class="listitem">
        <p><code class="code">mnh1xmpli7/prod/ANY/user</code> – ANY method on the <code class="code">user</code> resource in the
            <code class="code">prod</code> stage.</p>
      </li><li class="listitem">
        <p><code class="code">mnh1xmpli7/*/*/*</code> – Any method on all resources in all stages.</p>
      </li></ul></div>
    <p>For details on viewing the policy and removing statements, see <a href="./access-control-resource-based.html#permissions-resource-cleanup">Cleaning up resource-based policies</a>.</p>
   
    <h2 id="services-apigateway-errors">Handling errors with an API Gateway API</h2>
    
    <p>API Gateway treats all invocation and function errors as internal errors. If the Lambda API rejects the invocation
      request, API Gateway returns a 500 error code. If the function runs but returns an error, or returns a response in the
      wrong format, API Gateway returns a 502. In both cases, the body of the response from API Gateway is <code class="code"><span>{</span>"message":
        "Internal server error"}</code>.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>API Gateway does not retry any Lambda invocations. If Lambda returns an error, API Gateway returns an error response to
        the client.</p></div></div>
    <p>The following example shows an X-Ray trace map for a request that resulted in a function error and a 502 from
      API Gateway. The client receives the generic error message.</p>
    <div class="mediaobject">
       
        <img src="/images/lambda/latest/dg/images/tracemap-apig-502.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        Trace map for a function error with API Gateway.&#xA;      " style="max-width:100%" />
       
       
    </div>
    <p>To customize the error response, you must catch errors in your code and format a response in the required
      format.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/nodejs-apig/function/index.js" rel="noopener noreferrer" target="_blank"><span>index.js</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Error
        formatting</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="javascript ">var formatError = function(error)<span>{</span>
  var response = <span>{</span>
    "statusCode": error.statusCode,
    "headers": <span>{</span>
      "Content-Type": "text/plain",
      "x-amzn-ErrorType": error.code
    },
    "isBase64Encoded": false,
    "body": error.code + ": " + error.message
  }
  return response
}</code></pre></div></div>
    <p>API Gateway converts this response into an HTTP error with a custom status code and body. In the trace map, the
      function node is green because it handled the error.</p>
    <div class="mediaobject">
       
        <img src="/images/lambda/latest/dg/images/tracemap-apig-404.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        Trace map for a formatted error with API Gateway.&#xA;      " style="max-width:100%" />
       
       
    </div>
   
    <h2 id="services-apigateway-apitypes">Choosing an API type</h2>
    
    <p>API Gateway supports three types of APIs that invoke Lambda functions:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>HTTP API</b> – A lightweight, low-latency RESTful API.</p>
      </li><li class="listitem">
        <p><b>REST API</b> – A customizable, feature-rich RESTful API.</p>
      </li><li class="listitem">
        <p><b>WebSocket API</b> – A web API that maintains persistent connections
          with clients for full-duplex communication.</p>
      </li></ul></div>
    
    <p>HTTP APIs and REST APIs are both RESTful APIs that process HTTP requests and return responses. HTTP APIs are
      newer and are built with the API Gateway version 2 API. The following features are new for HTTP APIs:</p>
    <div class="itemizedlist">
      <h6>HTTP API features</h6>
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>Automatic deployments</b> – When you modify routes or integrations,
          changes deploy automatically to stages that have automatic deployment enabled.</p>
      </li><li class="listitem">
        <p><b>Default stage</b> – You can create a default stage
            (<code class="code">$default</code>) to serve requests at the root path of your API's URL. For named stages, you must
          include the stage name at the beginning of the path.</p>
      </li><li class="listitem">
        <p><b>CORS configuration</b> – You can configure your API to add CORS
          headers to outgoing responses, instead of adding them manually in your function code.</p>
      </li></ul></div>
    
    <p>REST APIs are the classic RESTful APIs that API Gateway has supported since launch. REST APIs currently have more
      customization, integration, and management features.</p>
    <div class="itemizedlist">
      <h6>REST API features</h6>
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><b>Integration types</b> – REST APIs support custom Lambda integrations.
          With a custom integration, you can send just the body of the request to the function, or apply a transform
          template to the request body before sending it to the function.</p>
      </li><li class="listitem">
        <p><b>Access control</b> – REST APIs support more options for authentication
          and authorization.</p>
      </li><li class="listitem">
        <p><b>Monitoring and tracing</b> – REST APIs support AWS X-Ray tracing and
          additional logging options.</p>
      </li></ul></div>
    
    <p>For a detailed comparison, see <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-vs-rest.html">Choosing between HTTP APIs and
        REST APIs</a> in the <em>API Gateway Developer Guide</em>.</p>
    
    <p>WebSocket APIs also use the API Gateway version 2 API and support a similar feature set. Use a WebSocket API for
      applications that benefit from a persistent connection between the client and API. WebSocket APIs provide
      full-duplex communication, which means that both the client and the API can send messages continuously without
      waiting for a response.</p>
    
    <p>HTTP APIs support a simplified event format (version 2.0). The following example shows an event from an HTTP
      API.</p>
    <div class="example"><h6>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/nodejs-apig/event-v2.json" rel="noopener noreferrer" target="_blank"><span>event-v2.json</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – API Gateway proxy event
        (HTTP API)</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "version": "2.0",
    "routeKey": "ANY /nodejs-apig-function-1G3XMPLZXVXYI",
    "rawPath": "/default/nodejs-apig-function-1G3XMPLZXVXYI",
    "rawQueryString": "",
    "cookies": [
        "s_fid=7AABXMPL1AFD9BBF-0643XMPL09956DE2",
        "regStatus=pre-register"
    ],
    "headers": <span>{</span>
        "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
        "accept-encoding": "gzip, deflate, br",
        ...
    },
    "requestContext": <span>{</span>
        "accountId": "123456789012",
        "apiId": "r3pmxmplak",
        "domainName": "r3pmxmplak.execute-api.us-east-2.amazonaws.com",
        "domainPrefix": "r3pmxmplak",
        "http": <span>{</span>
            "method": "GET",
            "path": "/default/nodejs-apig-function-1G3XMPLZXVXYI",
            "protocol": "HTTP/1.1",
            "sourceIp": "205.255.255.176",
            "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36"
        },
        "requestId": "JKJaXmPLvHcESHA=",
        "routeKey": "ANY /nodejs-apig-function-1G3XMPLZXVXYI",
        "stage": "default",
        "time": "10/Mar/2020:05:16:23 +0000",
        "timeEpoch": 1583817383220
    },
    "isBase64Encoded": true
}</code></pre></div></div>
    <p>For more information, see <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-lambda.html">AWS Lambda
        integrations</a> in the API Gateway Developer Guide.</p>
   
    <h2 id="services-apigateway-samples">Sample applications</h2>
    
    <p>The GitHub repository for this guide provides the following sample application for API Gateway.</p>
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/nodejs-apig" rel="noopener noreferrer" target="_blank"><span>API Gateway with Node.js</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A function with an AWS SAM
          template that creates a REST API that has AWS X-Ray tracing enabled. It includes scripts for deploying,
          invoking the function, testing the API, and cleanup.</p>
      </li></ul></div>
    
    <p>Lambda also provides <a href="./gettingstarted-features.html#gettingstarted-features-blueprints">blueprints</a> and <a href="./gettingstarted-features.html#gettingstarted-features-templates">templates</a> that you can use to create an API Gateway
      application in the Lambda console.</p>
    
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./services-alexa.html">Alexa</div><div id="next" class="next-link" accesskey="n" href="./services-apigateway-tutorial.html">Tutorial</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/services-apigateway.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/services-apigateway.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>